<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fun√ß√µes Executivas - Curso Completo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
		/* Container para v√≠deo responsivo (Mant√©m propor√ß√£o 16:9) */
	.video-container {
	    position: relative;
    	padding-bottom: 56.25%; /* Propor√ß√£o 16:9 */
    	height: 0;
    	overflow: hidden;
    	max-width: 100%;
    	border-radius: 12px; /* Arredondado igual aos cards */
    	border: 1px solid #374151;
    	margin: 30px 0;
    	box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
	}

	.video-container iframe {
    	position: absolute;
    	top: 0;
    	left: 0;
    	width: 100%;
    	height: 100%;
    	border: 0;
	}
	/* Estilo para imagens ilustrativas dentro das se√ß√µes */
	.concept-image {
    		width: 100%;
   		max-width: 600px; /* Tamanho m√°ximo para n√£o ficar gigante */
    		height: auto;
    		display: block;
   		 margin: 25px auto; /* Centraliza horizontalmente */
    		border-radius: 12px;
    		box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); /* Sombra para destaque */
    		border: 1px solid #374151; /* Borda sutil */
    		transition: transform 0.3s;
	}

	.concept-image:hover {
    		transform: scale(1.02); /* Leve zoom ao passar o mouse */
    		border-color: #06b6d4;
	}
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #111827 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: rgba(31, 41, 55, 0.95);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .hidden { display: none !important; }

        /* Navega√ß√£o */
        .top-nav {
            margin-bottom: 20px;
            text-align: center;
            position: relative; /* <-- NOVO */
            z-index: 11;      /* <-- NOVO */
        }
        .top-nav select {
            width: 100%;
            padding: 12px;
            background-color: #1f2937;
            color: #ffffff;
            border: 2px solid #374151;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
        }
        .top-nav select:focus {
            outline: none;
            border-color: #06b6d4;
        }
        
        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #374151;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #06b6d4 0%, #22c55e 100%);
            transition: width 0.5s ease;
        }
        .progress-text {
            text-align: center;
            color: #9ca3af;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        /* Typography */
        h1 {
            font-size: 2.5rem;
            color: #06b6d4;
            margin-bottom: 15px;
            text-align: center;
        }
        h2 {
            font-size: 1.8rem;
            color: #06b6d4;
            margin: 30px 0 15px 0;
        }
        h3 {
            font-size: 1.3rem;
            color: #ffffff;
            margin: 20px 0 10px 0;
        }
        p {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #d1d5db;
            margin-bottom: 15px;
        }
        
        /* Cards */
        .card {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #06b6d4;
        }
        
        .card-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 15px;
        }
        
        /* Lists */
        ul {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }
        ul li {
            padding: 12px 0;
            padding-left: 30px;
            position: relative;
            color: #d1d5db;
            line-height: 1.6;
        }
        ul li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 10px;
            color: #06b6d4;
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        /* Buttons */
        button {
            background-color: #06b6d4;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            padding: 15px 35px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 20px 5px;
            display: inline-block;
        }
        button:hover {
            background-color: #0891b2;
            transform: scale(1.05);
        }
        button:active {
            transform: scale(0.95);
        }
        button:disabled {
            background-color: #374151;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background-color: #4b5563;
        }
        .btn-secondary:hover {
            background-color: #6b7280;
        }

        .btn-danger {
            background-color: #991b1b;
        }
        .btn-danger:hover {
            background-color: #b91c1c;
        }

        .btn-center {
            text-align: center;
            margin-top: 30px;
        }

        /* Bot√µes de Navega√ß√£o Voltar/Avan√ßar */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            border-top: 1px solid #374151;
            padding-top: 20px;
            position: relative; /* <-- NOVO */
            z-index: 11;      /* <-- NOVO */
        }
        .navigation-buttons button {
            margin: 0;
        }
        
        /* Quiz */
        .quiz-container {
            background-color: #1f2937;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
        }
        
        .quiz-question {
            font-size: 1.3rem;
            color: #ffffff;
            margin-bottom: 25px;
            text-align: center;
            line-height: 1.6;
        }
        
        .quiz-option {
            background-color: #374151;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 12px 0;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            text-align: left;
        }
        
        .quiz-option:hover {
            background-color: #4b5563;
            border-color: #06b6d4;
            transform: translateX(5px);
        }
        
        .quiz-option.correct {
            background-color: #065f46;
            border-color: #22c55e;
        }
        
        .quiz-option.incorrect {
            background-color: #7f1d1d;
            border-color: #ef4444;
        }
        
        .quiz-option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .quiz-feedback {
            margin-top: 25px;
            padding: 20px;
            border-radius: 8px;
        }
        
        .quiz-feedback.correct {
            background-color: #065f46;
            border-left: 4px solid #22c55e;
        }
        
        .quiz-feedback.incorrect {
            background-color: #7f1d1d;
            border-left: 4px solid #ef4444;
        }
        
        .quiz-feedback h4 {
            color: #ffffff;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .quiz-score {
            text-align: center;
            font-size: 2rem;
            color: #fbbf24;
            margin: 30px 0;
            font-weight: bold;
        }
        
        /* Version Selection */
        .version-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 30px 0;
        }
        
        .version-card {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            padding: 30px;
            border-radius: 12px;
            border: 2px solid #374151;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .version-card:hover {
            border-color: #06b6d4;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(6, 182, 212, 0.3);
        }
        
        .version-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .badge-quick {
            background-color: #22c55e;
            color: #111827;
        }
        
        .badge-scientific {
            background-color: #3b82f6;
            color: #ffffff;
        }
        
        /* Experiment */
        /* Novo: Viewport para estabilizar o layout do teste */
        #experiment-viewport {
            min-height: 300px; /* Altura suficiente para o est√≠mulo */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            flex-direction: column;
            margin: 20px 0;
            position: relative; /* <--- MANTIDO */
            /* z-index: 11; */      /* <--- REMOVIDO (Este era o erro) */
        }

        #stimulus-element {
            /* REGRAS RESTAURADAS ABAIXO */
            font-size: 150px;
            font-weight: bold;
            min-height: 200px; /* Altura para alinhar com as cues */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* REGRAS RESTAURADAS ABAIXO */
        #feedback-element {
            font-size: 2.5rem;
            font-weight: bold;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .feedback-correct { color: #22c55e; }
        .feedback-incorrect { color: #ef4444; }
        
        #fixation-point {
            font-size: 4rem;
            color: #ffffff;
        }
        /* FIM DAS REGRAS RESTAURADAS */

        #inter-block-prompt {
            text-align: center;
            /* box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); */ /* Removido - Adicionando estilos completos abaixo */
            
            /* ESTILOS RESTAURADOS PARA O PROMPT ENTRE BLOCOS */
            padding: 50px;
            background-color: #111827;
            border-radius: 12px;
            margin: 40px 0;
            position: relative; /* Para z-index */
            z-index: 11; /* Para ficar acima do overlay de toque */
        }

        /* ESTILOS DO MODAL RESTAURADOS E COMPLETOS */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100; /* Acima de todo o resto */
        }
        .modal-content {
            background-color: #1f2937;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .modal-content h2 {
            font-size: 1.8rem;
            color: #06b6d4;
            margin-bottom: 30px;
        }
        .modal-content button {
            display: block;
            width: 100%;
            margin: 15px 0;
            font-size: 1.2rem;
            padding: 18px 30px;
        }
        /* FIM DOS ESTILOS DO MODAL */


        /* CSS NOVO: Overlay de Toque para Celular */
        #touch-overlay {
            position: fixed; /* Cobre a tela inteira */
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10;
            display: flex;
            pointer-events: none; /* <--- ALTERA√á√ÉO: Permite cliques 'atrav√©s' do overlay */
        }
        #touch-left, #touch-right {
            width: 50%;
            height: 100%;
            pointer-events: auto; /* <--- ALTERA√á√ÉO: Captura cliques/toques apenas nestas √°reas */
            /* Descomente para debug */
            /* background-color: rgba(255, 0, 0, 0.1); 
            border: 1px solid red; */
        }
        /* #touch-right { 
            background-color: rgba(0, 0, 255, 0.1); 
            border: 1px solid blue; 
        } */
        
        /* NOVO: Cues Visuais da Pr√°tica */
        #practice-cue-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 450px; /* Largura para posicionar as cues */
            height: 250px; /* Altura para posic. as cues */
            pointer-events: none; /* N√£o bloquear cliques/toques */
            transition: opacity 0.4s ease;
            z-index: 1; /* Atr√°s do est√≠mulo */
        }
        .cue-text {
            position: absolute;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            text-align: center;
            width: 150px; /* Largura fixa para os textos */
        }
        .cue-red { color: #ef4444; }
        .cue-blue { color: #3b82f6; }
        
        /* NOVO: Cores para o est√≠mulo principal (n√∫mero) */
        .cue-magnitude { color: #3b82f6; } /* Azul */
        .cue-parity { color: #ef4444; }  /* Vermelho */
        
        /* Posicionamento (relativo ao container) */
        #cue-parity-left { top: 20%; left: 0; }
        #cue-parity-right { top: 20%; right: 0; }
        #cue-magnitude-left { bottom: 20%; left: 0; }
        #cue-magnitude-right { bottom: 20%; right: 0; }
        
        /* Ajuste para mobile */
        @media (max-width: 768px) {
            #practice-cue-container {
                width: 90vw; /* Usar largura da tela */
                height: 200px; 
            }
            .cue-text { 
                font-size: 0.8rem; 
                width: 100px;
            }
            #cue-parity-left { top: 15%; left: 0; }
            #cue-parity-right { top: 15%; right: 0; }
            #cue-magnitude-left { bottom: 15%; left: 0; }
            #cue-magnitude-right { bottom: 15%; right: 0; }
        }
        /* FIM DO CSS NOVO */

        /* Charts */
        .chart-container {
            background-color: #1f2937;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        /* Results */
        .result-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .result-item {
            text-align: center;
            padding: 20px;
            background-color: #111827;
            border-radius: 8px;
        }
        
        .result-label {
            color: #9ca3af;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .result-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffffff;
        }
        
        /* Article Link */
        .article-link {
            background-color: #1f2937;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #06b6d4;
        }
        
        .article-link a {
            color: #22c55e;
            text-decoration: none;
            font-weight: bold;
        }
        
        .article-link a:hover {
            text-decoration: underline;
        }

        /* Statistical Analysis (do arquivo antigo) */
        .stat-box {
            background-color: #111827;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #06b6d4;
            text-align: left;
        }
        .stat-box h4 {
            color: #06b6d4;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        .stat-box p {
            color: #d1d5db;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 5px;
        }
        .stat-highlight {
            color: #fbbf24;
            font-weight: bold;
            font-size: 1.1rem;
        }
        .interpretation {
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            text-align: left;
        }
        .interpretation-good {
            background-color: #064e3b;
            color: #a7f3d0;
        }
        .interpretation-neutral {
            background-color: #78350f;
            color: #fde68a;
        }
        
        @media (max-width: 768px) {
            .version-grid, .charts-grid {
                grid-template-columns: 1fr;
            }
            h1 { font-size: 2rem; }
            .container { padding: 20px; }
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            .navigation-buttons button {
                width: 100%;
                font-size: 1rem;
                padding: 12px 20px;
            }
            .navigation-buttons div {
                display: flex;
                flex-direction: column;
                gap: 15px;
                width: 100%;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Navega√ß√£o Superior -->
    <nav class="top-nav">
        <select id="nav-menu" onchange="handleNavigation(this.value)">
            <option value="section-1">Se√ß√£o 1: O que s√£o FEs?</option>
            <option value="quiz-1">Quiz 1</option>
            <option value="section-2">Se√ß√£o 2: Processos Principais</option>
            <option value="quiz-2">Quiz 2</option>
            <option value="section-3">Se√ß√£o 3: Vias Neurais</option>
            <option value="quiz-3">Quiz 3</option>
            <option value="section-4">Se√ß√£o 4: Estudo fMRI</option>
            <option value="quiz-4">Quiz 4</option>
            <option value="section-5">Se√ß√£o 5: Escolha do Teste</option>
            <option value="section-6">Se√ß√£o 6: Instru√ß√µes do Teste</option>
            <option value="section-7">Se√ß√£o 7: Experimento</option>
            <option value="section-8">Se√ß√£o 8: Resultados</option>
            <option value="section-9">Se√ß√£o 9: Quiz Final</option>
        </select>
    </nav>

    <!-- Progress Bar -->
    <div class="progress-text" id="progress-text">Etapa 1 de 9</div>
    <div class="progress-bar">
        <div class="progress-fill" id="progress-fill" style="width: 11%"></div>
    </div>

    <!-- SE√á√ÉO 1 -->
<div id="section-1" class="section">
        <h1>üß† O que s√£o Fun√ß√µes Executivas?</h1>
        <p style="text-align: center; color: #9ca3af; font-size: 1.2rem; margin-bottom: 30px;">O "Coringa" do C√©rebro</p>
        
        <img src="https://images.unsplash.com/photo-1559757175-5700dde675bc?q=80&w=800&auto=format&fit=crop" 
             alt="Ilustra√ß√£o de uma rede neural representando o c√©rebro" 
             class="concept-image">

        <p>As <strong>Fun√ß√µes Executivas (FEs)</strong> n√£o s√£o uma habilidade cognitiva √∫nica, mas sim um conjunto de processos mentais de alto n√≠vel que atuam como o <strong>"gerente" ou "CEO" do c√©rebro</strong>. Elas s√£o respons√°veis por gerenciar e regular outras habilidades mais b√°sicas, como a mem√≥ria, a percep√ß√£o e a linguagem.</p>
        
        <h2>üÉè A Alegoria dos "4 Ases e 1 Coringa"</h2>
		<div class="card">
            <div class="card-icon">üÇ° üÇ± üÉÅ üÉë</div>
            <h3>Os "4 Ases" (Cogni√ß√£o Categ√≥rica)</h3>
            <p>S√£o nossas habilidades cognitivas fundamentais:</p>
            <ul>
                <li><strong>Percep√ß√£o:</strong> Como captamos informa√ß√µes do mundo</li>
                <li><strong>Linguagem:</strong> Como nos comunicamos</li>
                <li><strong>Mem√≥ria:</strong> Como armazenamos informa√ß√µes</li>
                <li><strong>Pr√°xis:</strong> Como executamos a√ß√µes motoras</li>
            </ul>
		<img src="figura1.webp" 
             	alt="Cartas de baralho sobre uma mesa escura" 
             	class="concept-image"
             	style="max-width: 500px;"> 
        </div>
        
        <div class="card" style="border-left-color: #fbbf24;">
            <div class="card-icon">üÉè</div>
            <h3>O "Coringa" (Fun√ß√µes Executivas)</h3>
            <p>Sozinhos, os "ases" s√£o apenas conhecimento est√°tico. O <strong>"Coringa"</strong> √© a FE que nos permite usar e aplicar esses ases de forma <strong>flex√≠vel</strong> para atingir objetivos no mundo real.</p>
        </div>
        
        <div class="card" style="background-color: #111827; border-left-color: #22c55e;">
            <h3>üí° Em resumo:</h3>
            <p style="font-size: 1.2rem; color: #22c55e; font-weight: bold;">N√£o basta ter mem√≥ria; a Fun√ß√£o Executiva √© o que nos permite usar essa mem√≥ria para planejar o futuro, resolver um problema ou adaptar nosso comportamento!</p>
        </div>
        
        <div class="navigation-buttons">
            <button class="btn-secondary" disabled style="opacity: 0;">‚Üê Voltar</button>
            <button onclick="navigateTo('quiz-1')">Fazer Quiz da Se√ß√£o 1 ‚Üí</button>
        </div>
    </div>
    <!-- QUIZ 1 -->
    <div id="quiz-1" class="section hidden">
        <h1>üìù Quiz: Se√ß√£o 1</h1>
        <div class="quiz-container">
            <div class="quiz-question" id="q1-question">O que melhor descreve as Fun√ß√µes Executivas?</div>
            <div class="quiz-option" onclick="answerQuiz(1, 0)">a) Uma √∫nica habilidade cognitiva</div>
            <div class="quiz-option" onclick="answerQuiz(1, 1)">b) O "gerente" que coordena outras habilidades</div>
            <div class="quiz-option" onclick="answerQuiz(1, 2)">c) Apenas a mem√≥ria</div>
            <div class="quiz-option" onclick="answerQuiz(1, 3)">d) Reflexos autom√°ticos</div>
            <div id="q1-feedback" class="hidden"></div>
        </div>
        
        <div class="quiz-container">
            <div class="quiz-question" id="q2-question">Na alegoria dos "4 Ases e 1 Coringa", o que representa o Coringa?</div>
            <div class="quiz-option" onclick="answerQuiz(2, 0)">a) Percep√ß√£o</div>
            <div class="quiz-option" onclick="answerQuiz(2, 1)">b) Mem√≥ria</div>
            <div class="quiz-option" onclick="answerQuiz(2, 2)">c) Fun√ß√µes Executivas</div>
            <div class="quiz-option" onclick="answerQuiz(2, 3)">d) Linguagem</div>
            <div id="q2-feedback" class="hidden"></div>
        </div>
        
        <div class="quiz-container">
            <div class="quiz-question" id="q3-question">Por que ter conhecimento ("ases") n√£o √© suficiente?</div>
            <div class="quiz-option" onclick="answerQuiz(3, 0)">a) Precisa das FEs para aplic√°-lo de forma flex√≠vel</div>
            <div class="quiz-option" onclick="answerQuiz(3, 1)">b) O conhecimento √© mais importante</div>
            <div class="quiz-option" onclick="answerQuiz(3, 2)">c) Os ases funcionam sozinhos</div>
            <div class="quiz-option" onclick="answerQuiz(3, 3)">d) N√£o precisamos de flexibilidade</div>
            <div id="q3-feedback" class="hidden"></div>
        </div>
        
        <div class="navigation-buttons">
            <button class="btn-secondary" onclick="navigateTo('section-1')">‚Üê Voltar</button>
            <button id="quiz1-continue" class="hidden" onclick="navigateTo('section-2')">Continuar para Se√ß√£o 2 ‚Üí</button>
        </div>
    </div>

    <!-- SE√á√ÉO 2 -->
    <div id="section-2" class="section hidden">
        <h1>‚öôÔ∏è Os Processos Principais</h1>
        <p style="text-align: center; color: #9ca3af; font-size: 1.2rem; margin-bottom: 30px;">Flexibilidade, Inibi√ß√£o e Planejamento</p>
        
        <p>As Fun√ß√µes Executivas s√£o compostas por tr√™s processos centrais que trabalham em conjunto:</p>
        
        <div class="card" style="border-left-color: #3b82f6;">
            <div class="card-icon">üîÑ</div>
            <h3 style="color: #3b82f6;">1. Flexibilidade Cognitiva</h3>
            <p style="font-style: italic; color: #9ca3af;">A "Mudan√ßa de Marcha"</p>
            <p>√â a capacidade de <strong>alternar</strong> entre diferentes tarefas, regras ou perspectivas de forma fluida. √â como mudar de marcha em um carro conforme a situa√ß√£o exige.</p>
            <p><strong>Exemplo:</strong> Quando voc√™ est√° lendo este texto e algu√©m chama seu nome, voc√™ precisa interromper a leitura e mudar sua aten√ß√£o para a pessoa.</p>
            <p style="margin-top: 15px; padding: 15px; background-color: #111827; border-radius: 8px;">üí° <strong>Descoberta importante:</strong> O c√©rebro pode aprender a <strong>esperar mudan√ßas</strong>. Se voc√™ sabe que vai precisar trocar de tarefa com frequ√™ncia, seu c√©rebro se prepara antecipadamente!</p>
        </div>
        
        <div class="card" style="border-left-color: #ef4444;">
            <div class="card-icon">üõë</div>
            <h3 style="color: #ef4444;">2. Inibi√ß√£o</h3>
            <p style="font-style: italic; color: #9ca3af;">O "Freio"</p>
            <p>√â a capacidade de <strong>controlar impulsos</strong>, suprimir respostas autom√°ticas e ignorar distra√ß√µes. Funciona como um freio mental.</p>
            <p><strong>Exemplo:</strong> No teste de Stroop, voc√™ v√™ a palavra "AZUL" escrita em tinta vermelha. Seu impulso √© ler "azul", mas voc√™ precisa inibir isso e dizer a cor da tinta: "vermelho".</p>
        </div>
        
        <div class="card" style="border-left-color: #22c55e;">
            <div class="card-icon">üèóÔ∏è</div>
            <h3 style="color: #22c55e;">3. Planejamento</h3>
            <p style="font-style: italic; color: #9ca3af;">O "Arquiteto"</p>
            <p>√â a capacidade de <strong>formular e organizar planos</strong> para alcan√ßar objetivos futuros. Como um arquiteto que projeta uma constru√ß√£o antes de come√ßar.</p>
            <p><strong>Exemplo:</strong> Na Torre de Londres, voc√™ precisa reorganizar discos coloridos em pinos seguindo regras espec√≠ficas, planejando cada movimento com anteced√™ncia.</p>
        </div>
        
        <div class="navigation-buttons">
            <button class="btn-secondary" onclick="navigateTo('quiz-1')">‚Üê Voltar</button>
            <button onclick="navigateTo('quiz-2')">Fazer Quiz da Se√ß√£o 2 ‚Üí</button>
        </div>
    </div>

    <!-- QUIZ 2 -->
    <div id="quiz-2" class="section hidden">
        <h1>üìù Quiz: Se√ß√£o 2</h1>
        <div class="quiz-container">
            <div class="quiz-question">Qual processo permite alternar entre diferentes tarefas?</div>
            <div class="quiz-option" onclick="answerQuiz(4, 0)">a) Planejamento</div>
            <div class="quiz-option" onclick="answerQuiz(4, 1)">b) Flexibilidade Cognitiva</div>
            <div class="quiz-option" onclick="answerQuiz(4, 2)">c) Inibi√ß√£o</div>
            <div class="quiz-option" onclick="answerQuiz(4, 3)">d) Mem√≥ria</div>
            <div id="q4-feedback" class="hidden"></div>
        </div>
        
        <div class="quiz-container">
            <div class="quiz-question">O Teste de Stroop mede qual processo?</div>
            <div class="quiz-option" onclick="answerQuiz(5, 0)">a) Planejamento</div>
            <div class="quiz-option" onclick="answerQuiz(5, 1)">b) Flexibilidade</div>
            <div class="quiz-option" onclick="answerQuiz(5, 2)">c) Inibi√ß√£o</div>
            <div class="quiz-option" onclick="answerQuiz(5, 3)">d) Percep√ß√£o</div>
            <div id="q5-feedback" class="hidden"></div>
        </div>
        
        <div class="quiz-container">
            <div class="quiz-question">Qual processo √© conhecido como o "Arquiteto"?</div>
            <div class="quiz-option" onclick="answerQuiz(6, 0)">a) Inibi√ß√£o</div>
            <div class="quiz-option" onclick="answerQuiz(6, 1)">b) Flexibilidade</div>
            <div class="quiz-option" onclick="answerQuiz(6, 2)">c) Planejamento</div>
            <div class="quiz-option" onclick="answerQuiz(6, 3)">d) Mem√≥ria operacional</div>
            <div id="q6-feedback" class="hidden"></div>
        </div>
        
        <div class="navigation-buttons">
            <button class="btn-secondary" onclick="navigateTo('section-2')">‚Üê Voltar</button>
            <button id="quiz2-continue" class="hidden" onclick="navigateTo('section-3')">Continuar para Se√ß√£o 3 ‚Üí</button>
        </div>
    </div>

    <!-- SE√á√ÉO 3 -->
    <div id="section-3" class="section hidden">
        <h1>üó∫Ô∏è Onde as Fun√ß√µes Executivas Acontecem?</h1>
        <p style="text-align: center; color: #9ca3af; font-size: 1.2rem; margin-bottom: 30px;">As Vias Neurais</p>
        
        <h2>üß† Parte 1: Al√©m dos Lobos Frontais</h2>
        
        <p>Historicamente, as Fun√ß√µes Executivas foram associadas apenas aos <strong>lobos frontais</strong> do c√©rebro. O famoso caso de <strong>Phineas Gage</strong> (1848), que sofreu uma les√£o frontal e mudou radicalmente de personalidade e comportamento, refor√ßou essa ideia.</p>
	<img src="PhineasGage_2.jpg" 
             alt="Cartas de baralho sobre uma mesa escura" 
             class="concept-image"
             style="max-width: 500px;">
        
        <div class="card">
            <p style="font-size: 1.1rem; line-height: 1.8;">Hoje sabemos que as FEs dependem de <strong>redes executivas distribu√≠das</strong> que incluem n√£o s√≥ regi√µes frontais, mas tamb√©m √°reas <strong>temporais</strong> e <strong>parietais</strong>. √â um trabalho em equipe!</p>
        </div>
        
        <h2>üîÑ Parte 2: As Al√ßas CSTC</h2>
        
        <p>As Fun√ß√µes Executivas dependem de circuitos chamados <strong>al√ßas c√≥rtico-estriado-t√°lamo-corticais (CSTC)</strong>:</p>
        
        <div class="card" style="background-color: #111827; padding: 30px; margin: 20px 0;">
            <h3 style="text-align: center; color: #06b6d4; margin-bottom: 20px;">Fluxo das Al√ßas CSTC</h3>
            <p style="text-align: center; font-size: 1.3rem; line-height: 2;">
                <strong style="color: #3b82f6;">C√≥rtex</strong> ‚Üí 
                <strong style="color: #22c55e;">N√∫cleos da Base (Estriado)</strong> ‚Üí 
                <strong style="color: #fbbf24;">T√°lamo</strong> ‚Üí 
                <strong style="color: #3b82f6;">C√≥rtex</strong>
            </p>
        </div>
        
        <p>Existem duas al√ßas principais para as Fun√ß√µes Executivas:</p>
        
        <div class="card" style="border-left-color: #3b82f6;">
            <h3 style="color: #3b82f6;">‚ùÑÔ∏è Al√ßa Dorsolateral</h3>
            <p style="font-style: italic; color: #9ca3af;">Cogni√ß√£o "Fria"</p>
            <p>Respons√°vel por processos cognitivos l√≥gicos e n√£o-emocionais:</p>
            <ul>
                <li>Planejamento racional</li>
                <li>Flexibilidade cognitiva</li>
                <li>Mem√≥ria de trabalho</li>
                <li>Tomada de decis√£o baseada em l√≥gica</li>
            </ul>
        </div>
        
        <div class="card" style="border-left-color: #ef4444;">
            <h3 style="color: #ef4444;">üî• Al√ßa Orbital-Ventromedial</h3>
            <p style="font-style: italic; color: #9ca3af;">Cogni√ß√£o "Quente"</p>
            <p>Respons√°vel por processos com carga emocional e social:</p>
            <ul>
                <li>Regula√ß√£o emocional</li>
                <li>Tomada de decis√£o social</li>
                <li>Controle de impulsos emocionais</li>
                <li>Julgamento moral</li>
            </ul>
        </div>
        
        <h2>üîó Parte 3: Rede Fronto-Parietal</h2>
        
        <p>Para a <strong>flexibilidade cognitiva</strong> especificamente, a rede mais importante √© a <strong>Rede Fronto-Parietal</strong>:</p>
        
        <div class="card" style="border-left-color: #06b6d4;">
            <h3>üåê Rede Fronto-Parietal</h3>
    		<div class="video-container">
        		<iframe width="560" height="315" src="https://www.youtube.com/embed/TNkoz314h3Y?si=I5420wjukPgKLE3z" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
    		</div>
            <p>Conecta o <strong>c√≥rtex frontal lateral</strong> com o <strong>c√≥rtex parietal</strong>. Esta rede forma um sistema robusto para:</p>
            <ul>
                <li>Monitorar o ambiente em busca de mudan√ßas</li>
                <li>Adaptar o comportamento conforme necess√°rio</li>
                <li>Alternar entre diferentes conjuntos de tarefas</li>
                <li>Aprender padr√µes de quando mudan√ßas ocorrem</li>
            </ul>
            <p style="margin-top: 15px; padding: 15px; background-color: #1f2937; border-radius: 8px;">üí° Esta rede ser√° o foco do estudo de fMRI que veremos na pr√≥xima se√ß√£o!</p>
        </div>
        
        <div class="navigation-buttons">
            <button class="btn-secondary" onclick="navigateTo('quiz-2')">‚Üê Voltar</button>
            <button onclick="navigateTo('quiz-3')">Fazer Quiz da Se√ß√£o 3 ‚Üí</button>
        </div>
    </div>

    <!-- QUIZ 3 -->
    <div id="quiz-3" class="section hidden">
        <h1>üìù Quiz: Se√ß√£o 3</h1>
        <div class="quiz-container">
            <div class="quiz-question">As Fun√ß√µes Executivas ocorrem apenas nos lobos frontais?</div>
            <div class="quiz-option" onclick="answerQuiz(7, 0)">a) Sim, exclusivamente</div>
            <div class="quiz-option" onclick="answerQuiz(7, 1)">b) N√£o, dependem de redes distribu√≠das</div>
            <div class="quiz-option" onclick="answerQuiz(7, 2)">c) S√≥ no t√°lamo</div>
            <div class="quiz-option" onclick="answerQuiz(7, 3)">d) S√≥ nos n√∫cleos da base</div>
            <div id="q7-feedback" class="hidden"></div>
        </div>
        
        <div class="quiz-container">
            <div class="quiz-question">Qual al√ßa CSTC √© respons√°vel pela cogni√ß√£o "fria" (planejamento l√≥gico)?</div>
            <div class="quiz-option" onclick="answerQuiz(8, 0)">a) Orbital-Ventromedial</div>
            <div class="quiz-option" onclick="answerQuiz(8, 1)">b) Dorsolateral</div>
            <div class="quiz-option" onclick="answerQuiz(8, 2)">c) Temporal</div>
            <div class="quiz-option" onclick="answerQuiz(8, 3)">d) Occipital</div>
            <div id="q8-feedback" class="hidden"></div>
        </div>
        
        <div class="quiz-container">
            <div class="quiz-question">Qual rede √© especialmente importante para flexibilidade cognitiva?</div>
            <div class="quiz-option" onclick="answerQuiz(9, 0)">a) Rede l√≠mbica</div>
            <div class="quiz-option" onclick="answerQuiz(9, 1)">b) Rede visual</div>
            <div class="quiz-option" onclick="answerQuiz(9, 2)">c) Rede Fronto-Parietal</div>
            <div class="quiz-option" onclick="answerQuiz(9, 3)">d) Rede auditiva</div>
            <div id="q9-feedback" class="hidden"></div>
        </div>
        
        <div class="navigation-buttons">
            <button class="btn-secondary" onclick="navigateTo('section-3')">‚Üê Voltar</button>
            <button id="quiz3-continue" class="hidden" onclick="navigateTo('section-4')">Continuar para Se√ß√£o 4 ‚Üí</button>
        </div>
    </div>

    <!-- SE√á√ÉO 4 -->
    <div id="section-4" class="section hidden">
        <h1>üî¨ Ilustrando a Flexibilidade na Pr√°tica</h1>
        <p style="text-align: center; color: #9ca3af; font-size: 1.2rem; margin-bottom: 30px;">Estudo Moderno de fMRI</p>
        
        <div class="article-link">
            <p style="color: #06b6d4; font-weight: bold; margin-bottom: 10px;">üìö Artigo Cient√≠fico Original</p>
            <p style="margin-bottom: 10px;">Sali, A. W., Bejjani, C., & Egner, T. (2024). Learning Cognitive Flexibility: Neural Substrates of Adapting Switch-Readiness to Time-Varying Demands. <em>Journal of Cognitive Neuroscience</em>.</p>
            <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10902878/" target="_blank">üîó Leia o artigo completo aqui ‚Üí</a>
        </div>
        
        <h2>üéØ Introdu√ß√£o ao Estudo</h2>
        
        <p>Um estudo recente (2024) usou <strong>resson√¢ncia magn√©tica funcional (fMRI)</strong> para investigar como o c√©rebro ajusta a <strong>"prontid√£o para mudan√ßa"</strong> (switch-readiness) de acordo com a frequ√™ncia de trocas de tarefa.</p>
        
        <h2>üß™ Como Funcionou o Experimento</h2>
        
        <div class="card">
            <h3>Tarefa de Classifica√ß√£o</h3>
            <p>Os participantes viam n√∫meros e tinham que julg√°-los de duas formas diferentes:</p>
            <ul>
                <li><strong style="color: #3b82f6;">AZUL:</strong> Julgar por <strong>magnitude</strong> (menor ou maior que 5)</li>
                <li><strong style="color: #ef4444;">VERMELHO:</strong> Julgar por <strong>paridade</strong> (√≠mpar ou par)</li>
            </ul>
            <p style="margin-top: 15px;">A cor do n√∫mero indicava qual tarefa executar. √Äs vezes a tarefa se repetia, √†s vezes mudava!</p>
		<img src="Figura_Experimento 1_portugues.jpg" 
             		alt="Cartas de baralho sobre uma mesa escura" 
             		class="concept-image"
             		style="max-width: 500px;">
        </div>
        
        <div class="card" style="border-left-color: #fbbf24;">
            <h3>üìä Manipula√ß√£o Experimental</h3>
            <p>O experimento tinha <strong>tr√™s blocos</strong> com diferentes frequ√™ncias de mudan√ßa:</p>
            <ul>
                <li><strong>25%:</strong> Mudan√ßas eram raras (maioria repeti√ß√µes)</li>
                <li><strong>50%:</strong> Mudan√ßas e repeti√ß√µes eram equilibradas</li>
                <li><strong>75%:</strong> Mudan√ßas eram frequentes</li>
            </ul>
        </div>
        
        <h2>üé® O que se Observou</h2>
        
        <div class="card" style="background-color: #111827; border-left-color: #22c55e;">
            <h3 style="color: #22c55e;">üß† O C√©rebro Aprende!</h3>
            <p style="font-size: 1.2rem; line-height: 1.8;">Quando as mudan√ßas eram <strong>frequentes</strong> (75%), os participantes ficavam <strong>"prontos para mudar"</strong>. Os custos de troca (o tempo extra necess√°rio para trocar de tarefa) <strong>diminu√≠am</strong>!</p>
            <p style="margin-top: 15px;">Quando mudan√ßas eram raras (25%), o c√©rebro "relaxava" e mantinha o foco na tarefa atual.</p>
            <p style="margin-top: 15px; font-weight: bold; color: #22c55e;">üí° Conclus√£o: O c√©rebro aprende "o qu√£o flex√≠vel precisa ser" baseado no contexto!</p>
        </div>
        
        <h2>üîç Conex√£o Neural (fMRI Revelou)</h2>
        
        <p>A neuroimagem mostrou que a <strong>Rede Fronto-Parietal</strong> estava em a√ß√£o:</p>
        
        <div class="card" style="border-left-color: #3b82f6;">
            <img src="Figura_experimento 2_portugues.jpg" 
             alt="Cartas de baralho sobre uma mesa escura" 
             class="concept-image"
             style="max-width: 500px;">
            <h3>C√≥rtex Parietal (IPS - Sulco Intraparietal)</h3>
            <ul>
                <li>Detectava quando ocorria uma "surpresa" (Erro de Predi√ß√£o)</li>
                <li>Quando o c√©rebro esperava repeti√ß√£o mas houve troca, o IPS "acendia"</li>
                <li>Sinal: "Ei, ajuste suas expectativas!"</li>
            </ul>
        </div>
        
        <div class="card" style="border-left-color: #ef4444;">
            <div class="card-icon">üõë</div>
            <h3>C√≥rtex Frontal Lateral</h3>
            <ul>
                <li>Coordenava a troca entre tarefas</li>
                <li>Inibia a regra antiga e ativava a nova</li>
                <li>Trabalhava junto com o IPS para adaptar comportamento</li>
            </ul>
        </div>
        
        <div class="card" style="background-color: #111827; border-left-color: #06b6d4;">
            <h3 style="color: #06b6d4;">üåê Conclus√£o do Estudo</h3>
		<img src="Figura_Experimento_3_portugues.jpg" 
             alt="Cartas de baralho sobre uma mesa escura" 
             class="concept-image"
             style="max-width: 500px;">
            <p style="font-size: 1.1rem; line-height: 1.8;">Este estudo mostra que <strong>Flexibilidade Cognitiva</strong> n√£o √© est√°tica - √© um <strong>processo din√¢mico de aprendizagem</strong> mediado pela <strong>rede fronto-parietal</strong>. Nosso c√©rebro constantemente atualiza suas expectativas sobre quando mudan√ßas v√£o ocorrer!</p>
        </div>
        
        <div class="navigation-buttons">
            <button class="btn-secondary" onclick="navigateTo('quiz-3')">‚Üê Voltar</button>
            <button onclick="navigateTo('quiz-4')">Fazer Quiz da Se√ß√£o 4 ‚Üí</button>
        </div>
    </div>

    <!-- QUIZ 4 -->
    <div id="quiz-4" class="section hidden">
        <h1>üìù Quiz: Se√ß√£o 4</h1>
        <div class="quiz-container">
            <div class="quiz-question">O que o estudo de fMRI (Sali et al., 2024) investigou?</div>
            <div class="quiz-option" onclick="answerQuiz(10, 0)">a) Mem√≥ria de longo prazo</div>
            <div class="quiz-option" onclick="answerQuiz(10, 1)">b) Como o c√©rebro ajusta prontid√£o para mudan√ßa</div>
            <div class="quiz-option" onclick="answerQuiz(10, 2)">c) Linguagem</div>
            <div class="quiz-option" onclick="answerQuiz(10, 3)">d) Percep√ß√£o visual</div>
            <div id="q10-feedback" class="hidden"></div>
        </div>
        
        <div class="quiz-container">
            <div class="quiz-question">O que acontecia quando as mudan√ßas eram frequentes (75%)?</div>
            <div class="quiz-option" onclick="answerQuiz(11, 0)">a) As pessoas ficavam mais lentas</div>
            <div class="quiz-option" onclick="answerQuiz(11, 1)">b) O custo de troca diminu√≠a</div>
            <div class="quiz-option" onclick="answerQuiz(11, 2)">c) N√£o mudava nada</div>
            <div class="quiz-option" onclick="answerQuiz(11, 3)">d) As pessoas erravam mais</div>
            <div id="q11-feedback" class="hidden"></div>
        </div>
        
        <div class="quiz-container">
            <div class="quiz-question">Qual regi√£o cerebral aumentou atividade ao detectar "surpresas"?</div>
            <div class="quiz-option" onclick="answerQuiz(12, 0)">a) Hipocampo</div>
            <div class="quiz-option" onclick="answerQuiz(12, 1)">b) Am√≠gdala</div>
            <div class="quiz-option" onclick="answerQuiz(12, 2)">c) Sulco Intraparietal (IPS)</div>
            <div class="quiz-option" onclick="answerQuiz(12, 3)">d) Cerebelo</div>
            <div id="q12-feedback" class="hidden"></div>
        </div>
        
        <div class="navigation-buttons">
            <button class="btn-secondary" onclick="navigateTo('section-4')">‚Üê Voltar</button>
            <button id="quiz4-continue" class="hidden" onclick="navigateTo('section-5')">Agora vamos experimentar na pr√°tica! ‚Üí</button>
        </div>
    </div>

    <!-- ESCOLHA DE VERS√ÉO -->
    <div id="section-5" class="section hidden">
        <h1>üéÆ Agora √© sua vez!</h1>
        <p style="text-align: center; font-size: 1.2rem; line-height: 1.8; margin: 30px 0;">Voc√™ acabou de aprender sobre flexibilidade cognitiva e como o c√©rebro se adapta. Agora vamos experimentar na pr√°tica o <strong>mesmo teste usado no estudo de fMRI</strong>!</p>
        
        <p style="text-align: center; color: #9ca3af; margin-bottom: 30px;">Escolha uma vers√£o:</p>
        
        <div class="version-grid">
            <div class="version-card" onclick="selectTestVersion('quick')">
                <div class="version-badge badge-quick">VERS√ÉO DEMONSTRATIVA</div>
                <h3 style="margin: 20px 0;">Teste R√°pido</h3>
                <ul style="text-align: left;">
                    <li>20 tentativas por bloco</li>
                    <li id="quick-version-duration">Dura√ß√£o: ~X-Y minutos</li>
                    <li>Ideal para experimentar</li>
                    <li>Visualiza√ß√£o de resultados</li>
                </ul>
                <button class="version-btn" style="width: 100%; margin-top: 20px;">Come√ßar Vers√£o R√°pida</button>
            </div>
            
            <div class="version-card" onclick="selectTestVersion('scientific')">
                <div class="version-badge badge-scientific">VERS√ÉO CIENT√çFICA</div>
                <h3 style="margin: 20px 0;">Teste Completo</h3>
                <ul style="text-align: left;">
                    <li>49 tentativas por bloco (protocolo original)</li>
                    <li id="scientific-version-duration">Dura√ß√£o: ~X-Y minutos</li>
                    <li>An√°lise estat√≠stica completa</li>
                    <li>Trimming de outliers</li>
                </ul>
                <button class="version-btn" style="width: 100%; background-color: #3b82f6; margin-top: 20px;">Come√ßar Vers√£o Cient√≠fica</button>
            </div>
        </div>

        <div class="navigation-buttons">
            <button class="btn-secondary" onclick="navigateTo('quiz-4')">‚Üê Voltar</button>
            <span style="flex-grow: 1;"></span> <!-- Spacer -->
        </div>
    </div>

    <!-- INSTRU√á√ïES DO TESTE -->
    <div id="section-6" class="section hidden">
        <h1>üìã Instru√ß√µes do Teste</h1>
        
        <div class="card">
            <h3>Como Funciona:</h3>
            <ul>
                <li>Voc√™ ver√° um <strong>n√∫mero colorido</strong> na tela</li>
                <li>A <strong>COR</strong> indica qual tarefa realizar</li>
            </ul>
        </div>
        
        <div class="card" style="border-left-color: #3b82f6;">
            <h3 style="color: #3b82f6;">üîµ AZUL = Tarefa de MAGNITUDE</h3>
            <p>O n√∫mero √© <strong>menor</strong> ou <strong>maior</strong> que 5?</p>
        </div>
        
        <div class="card" style="border-left-color: #ef4444;">
            <h3 style="color: #ef4444;">üî¥ VERMELHO = Tarefa de PARIDADE</h3>
            <p>O n√∫mero √© <strong>√≠mpar</strong> ou <strong>par</strong>?</p>
        </div>
        
        <!-- ############# IN√çCIO DA CORRE√á√ÉO DE ESTRUTURA ############# -->
        <!-- Movido da duplicata que estava aqui -->
        
        <div class="card" style="background-color: #111827;" id="keyboard-instructions">
            <h3>‚å®Ô∏è Como Responder:</h3>
            <ul>
                <li>Tecla <strong>F</strong> (esquerda): N√∫mero <strong>menor que 5</strong> OU <strong>√≠mpar</strong></li>
                <li>Tecla <strong>J</strong> (direita): N√∫mero <strong>maior que 5</strong> OU <strong>par</strong></li>
            </ul>
        </div>
        
        <!-- HTML NOVO: Instru√ß√µes de Toque -->
        <div class="card hidden" style="background-color: #111827;" id="touch-instructions">
            <h3>üì± Como Responder (Celular):</h3>
            <ul>
                <li>Toque no <strong>LADO ESQUERDO</strong> da tela: N√∫mero <strong>menor que 5</strong> OU <strong>√≠mpar</strong></li>
                <li>Toque no <strong>LADO DIREITO</strong> da tela: N√∫mero <strong>maior que 5</strong> OU <strong>par</strong></li>
            </ul>
        </div>
        <!-- ############# FIM DA CORRE√á√ÉO DE ESTRUTURA ############# -->
        
        <div class="card" style="border-left-color: #fbbf24;">
            <h3>‚ö° Importante:</h3>
            <ul>
                <li>O n√∫mero aparece por apenas <strong>1 segundo</strong></li>
                <li>Responda o mais <strong>r√°pido e preciso</strong> poss√≠vel</li>
                <li>Primeiro voc√™ far√° uma <strong>pr√°tica com feedback</strong></li>
                <li>Depois vir√£o os <strong>blocos do teste sem feedback</strong></li>
            </ul>
        </div>
        
        <div class="navigation-buttons">
            <button class="btn-secondary" onclick="navigateTo('section-5')">‚Üê Voltar</button>
            <div>
                <button class="btn-secondary" onclick="navigateTo('section-9')">Pular Teste ‚Üí</button>
                <button onclick="startExperiment()">Come√ßar Teste ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- TELA DO EXPERIMENTO -->
    <div id="section-7" class="section hidden">
        <div id="block-indicator" style="text-align: center; color: #9ca3af; font-size: 1.1rem; margin-bottom: 20px;"></div>
        <div id="practice-counter" class="hidden" style="text-align: center; font-size: 1.5rem; color: #06b6d4; margin-bottom: 20px; font-weight: bold;"></div>
        
        <!-- REMOVIDO: Resumo das Instru√ß√µes da Pr√°tica (substitu√≠do por cues visuais) -->
        <!-- <div id="practice-instructions" class="hidden"> ... </div> -->

        <!-- Viewport para estabilizar o layout -->
        <div id="experiment-viewport" style="position: relative;"> <!-- <-- position: relative ADICIONADO -->

            <!-- NOVO: Container para as Cues Visuais da Pr√°tica -->
            <div id="practice-cue-container" class="hidden" style="opacity: 1;">
                <div class="cue-text cue-red" id="cue-parity-left">√çmpar</div>
                <div class="cue-text cue-red" id="cue-parity-right">Par</div>
                <div class="cue-text cue-blue" id="cue-magnitude-left">Menor que 5</div>
                <div class="cue-text cue-blue" id="cue-magnitude-right">Maior que 5</div>
            </div>

            <div id="fixation-point" class="hidden">+</div>
            <div id="stimulus-element" class="hidden" style="position: relative; z-index: 2;"></div> <!-- z-index adicionado -->
            <div id="feedback-element" class="hidden"></div>
            <div id="timeout-indicator" style="font-size: 1.5rem; color: #ef4444; margin-top: 20px;"></div>
        </div>
        
        <!-- HTML NOVO: Overlay de Toque -->
        <div id="touch-overlay" class="hidden">
            <div id="touch-left"></div>
            <div id="touch-right"></div>
        </div>

        <div id="inter-block-prompt" class="hidden">
            <h2>Bloco Conclu√≠do!</h2>
            <p>Fa√ßa uma pequena pausa. Clique abaixo quando estiver pronto para o pr√≥ximo bloco.</p>
            <button id="next-block-btn">Estou Pronto ‚Üí</button>
        </div>

        <!-- ############# ALTERA√á√ÉO SOLICITADA ############# -->
        <div class="navigation-buttons">
            <button class="btn-secondary" onclick="navigateTo('section-6')">‚Üê Voltar (Instru√ß√µes)</button>
            <button class="btn-danger" onclick="skipToResults()">Pular para os Resultados ‚è≠Ô∏è</button>
        </div>
        <!-- ############# FIM DA ALTERA√á√ÉO ############# -->
    </div>

    <!-- RESULTADOS -->
    <div id="section-8" class="section hidden">
        <h1>üìä Seus Resultados</h1>
        
        <!-- Container para os blocos de resultados (do arquivo v2) -->
        <div id="results-container"></div>
        
        <div class="chart-container">
            <h3>üìà Tempos de Rea√ß√£o por Tipo de Tentativa</h3>
            <div class="chart-wrapper">
                <canvas id="rtChart"></canvas>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="chart-container">
                <h3>üìâ Correla√ß√£o: Switches vs. Custo</h3>
                <div class="chart-wrapper" style="height: 350px;">
                    <canvas id="correlationChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h3>üéØ Acur√°cia por Bloco</h3>
                <div class="chart-wrapper" style="height: 350px;">
                    <canvas id="accuracyChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Container para an√°lise estat√≠stica (do arquivo antigo) -->
        <div id="statistical-analysis"></div>
        
        <!-- Container para interpreta√ß√£o neuro (do arquivo v2) -->
        <h2 style="margin-top: 40px;">üß† O que aconteceu no seu c√©rebro?</h2>
        
        <p style="font-size: 1.1rem; line-height: 1.8; margin: 20px 0;">Durante o teste, v√°rias regi√µes da sua <strong>Rede Fronto-Parietal</strong> trabalharam em conjunto:</p>
        
        <div class="card" style="border-left-color: #3b82f6;">
            <div class="card-icon">üëÅÔ∏è</div>
            <h3>Sulco Intraparietal (IPS)</h3>
            <ul>
                <li>Detectou quando a cor do n√∫mero mudava</li>
                <li>Calculou "erros de predi√ß√£o" (surpresas)</li>
                <li>Atualizou suas expectativas sobre a frequ√™ncia de mudan√ßas</li>
            </ul>
        </div>
        
        <div class="card" style="border-left-color: #ef4444;">
            <div class="card-icon">üõë</div>
            <h3>C√≥rtex Frontal Lateral</h3>
            <ul>
                <li>Inibiu a resposta da tarefa anterior</li>
                <li>Ativou a nova regra (magnitude ou paridade)</li>
                <li>Coordenou a troca entre tarefas</li>
            </ul>
        </div>
        
        <div class="card" style="border-left-color: #22c55e;">
            <div class="card-icon">üåê</div>
            <h3>Rede Fronto-Parietal (Completa)</h3>
            <ul>
                <li>Trabalhou como um sistema integrado</li>
                <li>Aprendeu os padr√µes ao longo dos blocos</li>
                <li>Ajustou sua "prontid√£o para mudar" de acordo com o contexto</li>
            </ul>
        </div>
        
        <!-- Container para interpreta√ß√£o neuro (do arquivo v2) -->
        <div id="brain-interpretation"></div>
        
        <div class="navigation-buttons">
            <button class="btn-secondary" onclick="navigateTo('section-7')">‚Üê Voltar (Teste)</button>
            <button onclick="navigateTo('section-9')">Fazer Quiz Final ‚Üí</button>
        </div>
    </div>

    <!-- QUIZ FINAL -->
    <div id="section-9" class="section hidden">
        <h1>üéì Quiz Final</h1>
        <p style="text-align: center; font-size: 1.1rem; color: #9ca3af; margin-bottom: 30px;">Teste seu conhecimento completo sobre Fun√ß√µes Executivas</p>
        
        <div class="quiz-container">
            <div class="quiz-question">Qual a principal fun√ß√£o das Fun√ß√µes Executivas?</div>
            <div class="quiz-option" onclick="answerQuiz(13, 0)">a) Armazenar mem√≥rias</div>
            <div class="quiz-option" onclick="answerQuiz(13, 1)">b) Gerenciar e coordenar outras habilidades cognitivas</div>
            <div class="quiz-option" onclick="answerQuiz(13, 2)">c) Processar linguagem</div>
            <div class="quiz-option" onclick="answerQuiz(13, 3)">d) Controlar movimentos b√°sicos</div>
            <div id="q13-feedback" class="hidden"></div>
        </div>
        
        <div class="quiz-container">
            <div class="quiz-question">Qual processo executivo age como "freio mental"?</div>
            <div class="quiz-option" onclick="answerQuiz(14, 0)">a) Planejamento</div>
            <div class="quiz-option" onclick="answerQuiz(14, 1)">b) Flexibilidade</div>
            <div class="quiz-option" onclick="answerQuiz(14, 2)">c) Inibi√ß√£o</div>
            <div class="quiz-option" onclick="answerQuiz(14, 3)">d) Mem√≥ria</div>
            <div id="q14-feedback" class="hidden"></div>
        </div>
        
        <div class="quiz-container">
            <div class="quiz-question">Qual rede neural √© crucial para flexibilidade cognitiva?</div>
            <div class="quiz-option" onclick="answerQuiz(15, 0)">a) Rede Fronto-Parietal</div>
            <div class="quiz-option" onclick="answerQuiz(15, 1)">b) Rede Visual</div>
            <div class="quiz-option" onclick="answerQuiz(15, 2)">c) Rede Auditiva</div>
            <div class="quiz-option" onclick="answerQuiz(15, 3)">d) Rede Motora</div>
            <div id="q15-feedback" class="hidden"></div>
        </div>
        
        <div class="quiz-container">
            <div class="quiz-question">O que o estudo de fMRI demonstrou sobre o c√©rebro?</div>
            <div class="quiz-option" onclick="answerQuiz(16, 0)">a) Ele √© inflex√≠vel</div>
            <div class="quiz-option" onclick="answerQuiz(16, 1)">b) Ele aprende e ajusta prontid√£o para mudan√ßa</div>
            <div class="quiz-option" onclick="answerQuiz(16, 2)">c) S√≥ usa lobos frontais</div>
            <div class="quiz-option" onclick="answerQuiz(16, 3)">d) N√£o se adapta a padr√µes</div>
            <div id="q16-feedback" class="hidden"></div>
        </div>
        
        <div class="quiz-container">
            <div class="quiz-question">Durante o teste, o que o IPS fazia ao detectar mudan√ßas?</div>
            <div class="quiz-option" onclick="answerQuiz(17, 0)">a) Desligava</div>
            <div class="quiz-option" onclick="answerQuiz(17, 1)">b) Calculava erro de predi√ß√£o e atualizava expectativas</div>
            <div class="quiz-option" onclick="answerQuiz(17, 2)">c) Apenas registrava cores</div>
            <div class="quiz-option" onclick="answerQuiz(17, 3)">d) Controlava emo√ß√µes</div>
            <div id="q17-feedback" class="hidden"></div>
        </div>
        
        <div id="final-score" class="hidden">
            <div class="quiz-score"></div>
            <div class="btn-center">
                <button onclick="restartCourse()">üîÑ Recome√ßar Curso</button>
            </div>
        </div>

        <div class="navigation-buttons">
            <button class="btn-secondary" onclick="navigateTo('section-8')">‚Üê Voltar (Resultados)</button>
            <span style="flex-grow: 1;"></span> <!-- Spacer -->
        </div>
    </div>

</div>

<!-- HTML NOVO: Modal de Sele√ß√£o de Dispositivo -->
<div id="device-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <h2>Como voc√™ vai responder?</h2>
        <button onclick="selectDevice('keyboard')">‚å®Ô∏è Computador (Teclado)</button>
        <button onclick="selectDevice('touch')">üì± Celular (Toque na Tela)</button>
    </div>
</div>

<script>
// ========================================
// CONFIGURA√á√ÉO GLOBAL
// ========================================

let currentSection = 1;
let selectedTestVersion = 'quick';
let TRIALS_PER_BLOCK = 20;
let USE_POST_ERROR_EXCLUSION = false;
let USE_RT_TRIMMING = false;
let inputMode = 'keyboard'; // NOVO: 'keyboard' ou 'touch'

// Quiz tracking
const quizAnswers = {
    1: 1, 2: 2, 3: 0,  // Quiz 1
    4: 1, 5: 2, 6: 2,  // Quiz 2
    7: 1, 8: 1, 9: 2,  // Quiz 3
    10: 1, 11: 1, 12: 2,  // Quiz 4
    13: 1, 14: 2, 15: 0, 16: 1, 17: 1  // Quiz Final
};

// MODIFICADO: Explica√ß√µes sem o prefixo "Correto!"
const quizExplanations = {
    1: "As FEs atuam como gerente, coordenando e regulando outras habilidades.",
    2: "O Coringa representa as Fun√ß√µes Executivas na alegoria.",
    3: "Precisamos das FEs para aplicar conhecimento de forma flex√≠vel.",
    4: "Flexibilidade Cognitiva permite alternar entre tarefas.",
    5: "O Teste de Stroop mede controle inibit√≥rio.",
    6: "Planejamento √© conhecido como o Arquiteto.",
    7: "As FEs dependem de redes distribu√≠das (frontais + parietais + temporais).",
    8: "A al√ßa Dorsolateral √© respons√°vel pela cogni√ß√£o 'fria'.",
    9: "A Rede Fronto-Parietal √© crucial para flexibilidade cognitiva.",
    10: "O estudo investigou como o c√©rebro ajusta prontid√£o para mudan√ßa.",
    11: "Com mudan√ßas frequentes, o custo de troca diminu√≠a.",
    12: "O IPS (Sulco Intraparietal) detectava surpresas e erros de predi√ß√£o.",
    13: "A principal fun√ß√£o √© gerenciar e coordenar outras habilidades.",
    14: "Inibi√ß√£o age como freio mental.",
    15: "A Rede Fronto-Parietal √© crucial para flexibilidade.",
    16: "O c√©rebro aprende e se adapta dinamicamente.",
    17: "O IPS calculava erros de predi√ß√£o e atualizava expectativas."
};

let quizProgress = {};
let finalQuizScore = 0;

// Experiment variables
const STIMULI = [1, 2, 3, 4, 6, 7, 8, 9];
const TASKS = { MAGNITUDE: 'MAGNITUDE', PARITY: 'PARITY' };
const KEYS = { LEFT: 'f', RIGHT: 'j' };
const PRACTICE_CRITERION = 6;
const STIMULUS_DURATION = 1000;
const RESPONSE_DEADLINE = 1000;
const ITI_MIN = 3000;
const ITI_MAX = 5000;
const PRACTICE_FEEDBACK_DURATION = 800;
const INTER_BLOCK_PAUSE = 3; // (Este valor n√£o √© mais um countdown, mas √© usado no c√°lculo de tempo)

let currentPhase = 'start';
let currentTrialState = null;
let currentBlockIndex = 0;
let currentTrialIndex = 0;
let currentTask = '';
let currentStimulus = 0;
let correctKey = '';
let trialStartTime = 0;
let trialSequence = [];
let resultsData = [];
let blockConfigs = [];
let consecutiveCorrect = 0;
let lastTrialWasError = false;

let responseDeadlineTimer, itiTimer, feedbackTimer;
let rtChart, correlationChart, accuracyChart;

// ========================================
// NAVEGA√á√ÉO
// ========================================

function hideAllSections() {
    const sections = document.querySelectorAll('.section');
    sections.forEach(s => s.classList.add('hidden'));
}

function updateProgress() {
    const progress = (currentSection / 9) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';
    document.getElementById('progress-text').textContent = `Etapa ${currentSection} de 9`;
}

function updateProgressById(sectionId) {
    const sectionMap = {
        'section-1': 1,
        'quiz-1': 1,
        'section-2': 2,
        'quiz-2': 2,
        'section-3': 3,
        'quiz-3': 3,
        'section-4': 4,
        'quiz-4': 4,
        'section-5': 5,
        'section-6': 6,
        'section-7': 7,
        'section-8': 8,
        'section-9': 9
    };
    currentSection = sectionMap[sectionId] || 1;
    updateProgress();
}

function navigateTo(sectionId) {
    hideAllSections();
    
    // Limpa timers do experimento se estivermos saindo da se√ß√£o 7
    if (currentTrialState !== null && sectionId !== 'section-7') {
        clearAllTimers();
        currentTrialState = null; // <--- CORRETO: Limpa o estado ao sair
        currentPhase = 'start';
        
        // ATUALIZADO: Limpa as novas cues visuais
        const cueContainer = document.getElementById('practice-cue-container');
        if (cueContainer) {
            cueContainer.classList.add('hidden');
            cueContainer.style.opacity = 1; // Reseta para a pr√≥xima vez
        }
    }

    const sectionElement = document.getElementById(sectionId);
    if (sectionElement) { // Adiciona checagem de seguran√ßa
        sectionElement.classList.remove('hidden');
    } else {
        console.error("Se√ß√£o n√£o encontrada:", sectionId);
        document.getElementById('section-1').classList.remove('hidden'); // Volta para a se√ß√£o 1
    }
    
    updateProgressById(sectionId);
    
    // Atualiza o dropdown para refletir a se√ß√£o atual
    document.getElementById('nav-menu').value = sectionId;
    
    window.scrollTo(0, 0);
}

function handleNavigation(sectionId) {
    // Esta fun√ß√£o √© chamada pelo dropdown
    navigateTo(sectionId);
}

// Fun√ß√µes antigas de navega√ß√£o (agora substitu√≠das por navigateTo)
function goToSection(sectionNum) {
    // Esta fun√ß√£o era chamada por bot√µes "Continuar"
    // Agora redirecionamos para navigateTo
    navigateTo(`section-${sectionNum}`);
}

function showQuiz(quizStartNum) {
    // Esta fun√ß√£o era chamada por bot√µes "Fazer Quiz"
    // Mapeamento de quizStartNum para ID do quiz
    const quizIdMap = {
        1: 'quiz-1',
        4: 'quiz-2',
        7: 'quiz-3',
        10: 'quiz-4'
    };
    const sectionId = quizIdMap[quizStartNum];
    if (sectionId) {
        navigateTo(sectionId);
    } else if (quizStartNum === 13) { // Caso especial do quiz final
        navigateTo('section-9');
    }
}
// Fim das fun√ß√µes de navega√ß√£o

function restartCourse() {
    quizProgress = {};
    finalQuizScore = 0;
    currentSection = 1;
    navigateTo('section-1');
    // Reseta os quizzes
    document.querySelectorAll('.quiz-option').forEach(opt => {
        opt.classList.remove('disabled', 'correct', 'incorrect');
        opt.style.pointerEvents = 'auto';
    });
    document.querySelectorAll('.quiz-feedback').forEach(fb => fb.classList.add('hidden'));
    document.querySelectorAll('[id$="-continue"]').forEach(btn => btn.classList.add('hidden'));
    document.getElementById('final-score').classList.add('hidden');
}

// ========================================
// QUIZ
// ========================================

function answerQuiz(questionNum, answerIndex) {
    const correct = (answerIndex === quizAnswers[questionNum]);
    const feedbackDiv = document.getElementById(`q${questionNum}-feedback`);
    
    // Mark answer
    const options = feedbackDiv.parentElement.querySelectorAll('.quiz-option');
    options.forEach((opt, idx) => {
        opt.classList.add('disabled');
        opt.style.pointerEvents = 'none';
        if (idx === quizAnswers[questionNum]) {
            opt.classList.add('correct');
        } else if (idx === answerIndex && !correct) {
            opt.classList.add('incorrect');
        }
    });
    
    // Show feedback
    feedbackDiv.classList.remove('hidden');
    feedbackDiv.className = correct ? 'quiz-feedback correct' : 'quiz-feedback incorrect';
    
    // MODIFICADO: Constr√≥i o feedback dinamicamente
    feedbackDiv.innerHTML = `
        <h4>${correct ? '‚úì Correto!' : '‚úó Incorreto'}</h4>
        <p>${quizExplanations[questionNum]}</p>
    `;
    
    // Track progress
    if (!quizProgress[questionNum]) {
        quizProgress[questionNum] = correct;
        
        // Check if quiz complete
        if (questionNum <= 3) {
            if (quizProgress[1] !== undefined && quizProgress[2] !== undefined && quizProgress[3] !== undefined) {
                document.getElementById('quiz1-continue').classList.remove('hidden');
            }
        } else if (questionNum <= 6) {
            if (quizProgress[4] !== undefined && quizProgress[5] !== undefined && quizProgress[6] !== undefined) {
                document.getElementById('quiz2-continue').classList.remove('hidden');
            }
        } else if (questionNum <= 9) {
            if (quizProgress[7] !== undefined && quizProgress[8] !== undefined && quizProgress[9] !== undefined) {
                document.getElementById('quiz3-continue').classList.remove('hidden');
            }
        } else if (questionNum <= 12) {
            if (quizProgress[10] !== undefined && quizProgress[11] !== undefined && quizProgress[12] !== undefined) {
                document.getElementById('quiz4-continue').classList.remove('hidden');
            }
        } else {
            // Final quiz
            if (correct) finalQuizScore++;
            if (quizProgress[13] !== undefined && quizProgress[14] !== undefined && 
                quizProgress[15] !== undefined && quizProgress[16] !== undefined && 
                quizProgress[17] !== undefined) {
                showFinalScore();
            }
        }
    }
}

function showFinalScore() {
    const percentage = (finalQuizScore / 5) * 100;
    let stars = '';
    let message = '';
    
    if (percentage === 100) {
        stars = '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê';
        message = 'üèÜ Expert em Fun√ß√µes Executivas!';
    } else if (percentage >= 80) {
        stars = '‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ';
        message = '‚≠ê Excelente dom√≠nio!';
    } else if (percentage >= 60) {
        stars = '‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ';
        message = '‚úÖ Bom conhecimento!';
    } else {
        stars = '‚≠ê‚≠ê‚òÜ‚òÜ‚òÜ';
        message = 'üìö Revise o material!';
    }
    
    document.getElementById('final-score').classList.remove('hidden');
    document.querySelector('.quiz-score').innerHTML = `
        <h2 style="color: #06b6d4; margin-bottom: 20px;">Resultado Final</h2>
        <p style="font-size: 2rem; font-weight: bold; color: #ffffff; margin: 20px 0;">
            ${finalQuizScore}/5 acertos (${percentage.toFixed(0)}%)
        </p>
        <p style="font-size: 1.5rem; margin: 20px 0;">${stars}</p>
        <p style="font-size: 1.2rem; color: #d1d5db; margin: 30px 0;">${message}</p>
    `;
}

// ========================================
// TEST VERSION SELECTION
// ========================================

function selectTestVersion(version) {
    selectedTestVersion = version;
    TRIALS_PER_BLOCK = version === 'quick' ? 20 : 49;
    USE_POST_ERROR_EXCLUSION = version === 'scientific';
    USE_RT_TRIMMING = version === 'scientific';
    
    // MODIFICADO: Em vez de navegar, mostra o modal
    document.getElementById('device-modal').classList.remove('hidden');
    // navigateTo('section-6'); // Removido
}

// NOVO: Seleciona o dispositivo, atualiza instru√ß√µes e navega
function selectDevice(mode) {
    inputMode = mode;
    document.getElementById('device-modal').classList.add('hidden');
    updateInstructionsForDevice();
    navigateTo('section-6');
}

// NOVO: Atualiza o texto das instru√ß√µes (Se√ß√£o 6)
function updateInstructionsForDevice() {
    if (inputMode === 'touch') {
        document.getElementById('keyboard-instructions').classList.add('hidden');
        document.getElementById('touch-instructions').classList.remove('hidden');
    } else {
        document.getElementById('keyboard-instructions').classList.remove('hidden');
        document.getElementById('touch-instructions').classList.add('hidden');
    }
}


function updateTestDurations() {
    const avgTrialTime = ((ITI_MIN + ITI_MAX) / 2 + RESPONSE_DEADLINE) / 1000; // em segundos
    const interBlockPause = 10; // Estimativa de pausa de 10s por bloco
    const numBlocks = 3;
    const practiceEstimate = 120; // 2 min estimativa para pr√°tica

    const quickTrials = 20;
    const sciTrials = 49;

    const quickDuration = (numBlocks * quickTrials * avgTrialTime) + ((numBlocks - 1) * interBlockPause) + practiceEstimate;
    const sciDuration = (numBlocks * sciTrials * avgTrialTime) + ((numBlocks - 1) * interBlockPause) + practiceEstimate;

    const quickMin = Math.round(quickDuration / 60);
    const sciMin = Math.round(sciDuration / 60);

    // Adiciona checagem para ver se os elementos existem antes de setar
    const quickEl = document.getElementById('quick-version-duration');
    const sciEl = document.getElementById('scientific-version-duration');

    if (quickEl) {
        quickEl.textContent = `Dura√ß√£o: ~${quickMin}-${quickMin + 3} minutos`;
    }
    if (sciEl) {
        sciEl.textContent = `Dura√ß√£o: ~${sciMin}-${sciMin + 3} minutos`;
    }
}

// ========================================
// FUN√á√ïES ESTAT√çSTICAS (DO ARQUIVO ANTIGO)
// ========================================

function getSDCriterion(n) {
    const criteria = {
        4: 1.458, 5: 1.68, 6: 1.841, 7: 1.961, 8: 2.05, 9: 2.12,
        10: 2.173, 11: 2.22, 12: 2.246, 13: 2.274, 14: 2.31,
        15: 2.326, 20: 2.391, 25: 2.41, 30: 2.4305, 35: 2.45,
        50: 2.48, 100: 2.5
    };

    if (n <= 3) return null;
    if (criteria[n]) return criteria[n];

    const sizes = Object.keys(criteria).map(Number).sort((a, b) => a - b);
    if (n < sizes[0]) return criteria[sizes[0]];
    if (n > sizes[sizes.length - 1]) return criteria[sizes[sizes.length - 1]];

    const lower = Math.max(...sizes.filter(s => s <= n));
    const upper = Math.min(...sizes.filter(s => s >= n));

    if (lower === upper) return criteria[lower];

    const x1 = lower, y1 = criteria[lower];
    const x2 = upper, y2 = criteria[upper];
    return y1 + (y2 - y1) * (n - x1) / (x2 - x1);
}

function modifiedRecursiveTrim(rts) {
    if (!USE_RT_TRIMMING || rts.length <= 4) return rts;

    let data = [...rts];
    let trimming = true;

    while (trimming && data.length > 4) {
        const n = data.length;
        const sd_criterion = getSDCriterion(n);
        if (!sd_criterion) break;

        const mean = data.reduce((a, b) => a + b, 0) / data.length;
        const variance = data.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / data.length;
        const sd = Math.sqrt(variance);

        const lower_limit = mean - sd_criterion * sd;
        const upper_limit = mean + sd_criterion * sd;

        const outliers = data.filter(rt => rt < lower_limit || rt > upper_limit);

        if (outliers.length === 0) {
            trimming = false;
        } else {
            // Encontra e remove o maior outlier
            let maxDistance = -1;
            let maxIndex = -1;
            for(let i=0; i < data.length; i++) {
                const dist = Math.max(lower_limit - data[i], data[i] - upper_limit);
                if (dist > maxDistance) {
                    maxDistance = dist;
                    maxIndex = i;
                }
            }
            if(maxIndex > -1) {
                data.splice(maxIndex, 1);
            } else {
                 trimming = false; // Seguran√ßa
            }
        }
    }
    return data;
}

function calculatePValue(r, n) {
    // C√°lculo aproximado do p-value para correla√ß√£o de Pearson
    // t = r * sqrt(n - 2) / sqrt(1 - r^2)
    if (n <= 2) return 1.0;
    // Evita divis√£o por zero se r for 1 ou -1
    if (Math.abs(r) === 1) return 0.0; 
    
    const t = Math.abs(r) * Math.sqrt(n - 2) / Math.sqrt(1 - r * r);

    // Aproxima√ß√£o do p-value usando distribui√ß√£o t
    // Para n=3 (3 blocos), df = 1
    // Valores cr√≠ticos: t(0.05, 1) ‚âà 12.71, t(0.10, 1) ‚âà 6.31
    if (n === 3) {
        if (t > 12.71) return 0.01; // (na verdade √© 0.05 bilateral, mas vamos simplificar)
        if (t > 6.31) return 0.05;
        if (t > 2.92) return 0.10;
        return 0.20; // > 0.10
    }
    // Para n > 3, aproxima√ß√£o mais geral (n√£o vai acontecer aqui, mas √© bom ter)
    const df = n - 2;
    if (t > 3.182) return 0.01;
    if (t > 2.306) return 0.05;
    if (t > 1.886) return 0.10;
    return 0.20; // > 0.10
}


// ========================================
// EXPERIMENT FUNCTIONS
// ========================================

function generateGuaranteedDistribution(totalTrials, targetMagnitudePct, targetSwitchPct) {
    const MAGNITUDE = 'MAGNITUDE';
    const PARITY = 'PARITY';
    
    const magTarget = Math.round(totalTrials * targetMagnitudePct / 100);
    const parTarget = totalTrials - magTarget;
    const switchTarget = Math.round((totalTrials - 1) * targetSwitchPct / 100);
    const repeatTarget = (totalTrials - 1) - switchTarget;
    
    const lastTaskArray = [MAGNITUDE, PARITY];
    let lastTask = lastTaskArray[Math.floor(Math.random() * lastTaskArray.length)];
    const sequence = [{ task: lastTask, type: 'first' }];
    
    let magRemaining = magTarget - (lastTask === MAGNITUDE ? 1 : 0);
    let parRemaining = parTarget - (lastTask === PARITY ? 1 : 0);
    let switchesRemaining = switchTarget;
    let repeatsRemaining = repeatTarget;
    
    for (let trialNum = 2; trialNum <= totalTrials; trialNum++) {
        let nextTask, trialType;
        
        if (switchesRemaining === 0) {
            nextTask = lastTask;
            trialType = 'repeat';
            repeatsRemaining--;
        } else if (repeatsRemaining === 0) {
            nextTask = lastTask === MAGNITUDE ? PARITY : MAGNITUDE;
            trialType = 'switch';
            switchesRemaining--;
        } else {
            const probSwitch = switchesRemaining / (switchesRemaining + repeatsRemaining);
            if (Math.random() < probSwitch) {
                nextTask = lastTask === MAGNITUDE ? PARITY : MAGNITUDE;
                trialType = 'switch';
                switchesRemaining--;
            } else {
                nextTask = lastTask;
                trialType = 'repeat';
                repeatsRemaining--;
            }
        }
        
        if (trialType === 'switch') {
            nextTask = lastTask === MAGNITUDE ? PARITY : MAGNITUDE;
        }
        
        if (nextTask === MAGNITUDE) {
            if (magRemaining > 0) {
                magRemaining--;
            } else {
                nextTask = PARITY;
                parRemaining--;
            }
        } else {
            if (parRemaining > 0) {
                parRemaining--;
            } else {
                nextTask = MAGNITUDE;
                magRemaining--;
            }
        }
        
        sequence.push({ task: nextTask, type: trialType });
        lastTask = nextTask;
    }
    
    return sequence;
}

function shuffle(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function getRandomItem(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

function getPseudoExponentialITI(min, max) {
    const range = max - min;
    const exponential = Math.pow(Math.random(), 2);
    return min + (exponential * range);
}

function getCorrectKey(task, stimulus) {
    if (task === TASKS.MAGNITUDE) {
        return (stimulus < 5) ? KEYS.LEFT : KEYS.RIGHT;
    } else {
        return (stimulus % 2 !== 0) ? KEYS.LEFT : KEYS.RIGHT;
    }
}

function clearAllTimers() {
    if (responseDeadlineTimer) clearTimeout(responseDeadlineTimer);
    if (itiTimer) clearTimeout(itiTimer);
    if (feedbackTimer) clearTimeout(feedbackTimer);
}

function startExperiment() {
    navigateTo('section-7');
    setupInputListeners(); // NOVO
    resultsData = [];
    
    const BASE_BLOCK_CONFIGS = [
        { prob: 0.25, trials: TRIALS_PER_BLOCK, name: "Baixa Frequ√™ncia (25%)" },
        { prob: 0.50, trials: TRIALS_PER_BLOCK, name: "M√©dia Frequ√™ncia (50%)" },
        { prob: 0.75, trials: TRIALS_PER_BLOCK, name: "Alta Frequ√™ncia (75%)" }
    ];
    
    blockConfigs = shuffle([...BASE_BLOCK_CONFIGS]);
    consecutiveCorrect = 0;
    lastTrialWasError = false;
    
    startPractice();
}

// NOVO: Ativa os listeners corretos (teclado ou toque)
function setupInputListeners() {
    if (inputMode === 'touch') {
        document.getElementById('touch-overlay').classList.remove('hidden');
        // Listeners de toque j√° s√£o adicionados no DOMContentLoaded
    } else {
        document.getElementById('touch-overlay').classList.add('hidden');
        // Listener de teclado j√° √© adicionado no DOMContentLoaded
    }
}


function startPractice() {
    currentPhase = 'practice';
    currentTrialIndex = 0;
    consecutiveCorrect = 0;
    trialSequence = generateGuaranteedDistribution(100, 50, 50);
    
    document.getElementById('practice-counter').classList.remove('hidden');
    updatePracticeCounter();
    
    currentTrialState = 'practice'; // <--- CORRE√á√ÉO: Define o estado inicial para o teste come√ßar
    
    // ATUALIZADO: Mostra e reseta as cues visuais
    const cueContainer = document.getElementById('practice-cue-container');
    cueContainer.classList.remove('hidden');
    cueContainer.style.opacity = 1;
    
    // REMOVIDA: L√≥gica antiga do 'practice-instructions'
    
    setTimeout(() => runTrial(), 500);
}

function updatePracticeCounter() {
    document.getElementById('practice-counter').textContent = 
        `Acertos consecutivos: ${consecutiveCorrect}/${PRACTICE_CRITERION}`;
}

function runTrial() {
    if (currentTrialState === null) return; // Prote√ß√£o para caso o teste seja interrompido

    if (currentPhase === 'practice') {
        document.getElementById('block-indicator').textContent = 'PR√ÅTICA';
    } else if (currentPhase === 'experiment') {
        if (currentTrialIndex >= TRIALS_PER_BLOCK) {
            startBlock(currentBlockIndex + 1); // Avan√ßa para o pr√≥ximo bloco
            return;
        }
        document.getElementById('block-indicator').textContent = 
            `Bloco ${currentBlockIndex + 1} de 3 | Tentativa ${currentTrialIndex + 1} de ${TRIALS_PER_BLOCK}`;
    }
    
    hideExperimentElements();
    
    const trial = trialSequence[currentTrialIndex];
    currentTask = trial.task;
    currentStimulus = getRandomItem(STIMULI);
    correctKey = getCorrectKey(currentTask, currentStimulus);
    
    const stimulusElement = document.getElementById('stimulus-element');
    stimulusElement.textContent = currentStimulus;
    stimulusElement.className = currentTask === TASKS.MAGNITUDE ? 'cue-magnitude' : 'cue-parity';
    stimulusElement.classList.remove('hidden');
    
    currentTrialState = 'awaiting-response';
    trialStartTime = performance.now();
    
    // MODIFICADO: S√≥ ativa o timer se N√ÉO estiver na pr√°tica
    if (currentPhase === 'experiment') {
        responseDeadlineTimer = setTimeout(handleTimeout, RESPONSE_DEADLINE);
    }
}

function hideExperimentElements() {
    document.getElementById('stimulus-element').classList.add('hidden');
    document.getElementById('fixation-point').classList.add('hidden');
    document.getElementById('feedback-element').classList.add('hidden');
    document.getElementById('timeout-indicator').textContent = '';
    document.getElementById('inter-block-prompt').classList.add('hidden');
}

function handleTimeout() {
    if (currentTrialState !== 'awaiting-response') return;
    
    // MODIFICADO: Como o timer s√≥ roda no 'experiment',
    // podemos remover o 'if/else' e ir direto para a l√≥gica do experiment.
    
    document.getElementById('stimulus-element').classList.add('hidden');
    document.getElementById('timeout-indicator').textContent = "Tempo Esgotado!";
    
    resultsData.push({
        block: currentBlockIndex,
        blockName: blockConfigs[currentBlockIndex].name, // Adicionado para an√°lise
        trial: currentTrialIndex,
        task: currentTask,
        trialType: trialSequence[currentTrialIndex].type,
        stimulus: currentStimulus,
        response: 'timeout',
        correct: false,
        rt: RESPONSE_DEADLINE,
        postError: lastTrialWasError
    });
    lastTrialWasError = true;
    startITI();
}

function handleKeyPress(e) {
    // MODIFICADO: Verifica o modo de input
    if (inputMode !== 'keyboard' || currentTrialState !== 'awaiting-response') return;
    
    const key = e.key.toLowerCase();
    if (key !== KEYS.LEFT && key !== KEYS.RIGHT) return;
    
    processResponse(key); // NOVO: Chama a fun√ß√£o refatorada
}

// NOVO: Listener de Toque
function handleTouchStart(e) {
    e.preventDefault(); // Previne zoom ou scroll
    
    // MODIFICADO: Verifica o modo de input
    if (inputMode !== 'touch' || currentTrialState !== 'awaiting-response') return;

    let key;
    if (e.currentTarget.id === 'touch-left') {
        key = KEYS.LEFT;
    } else {
        key = KEYS.RIGHT;
    }
    
    processResponse(key); // NOVO: Chama a fun√ß√£o refatorada
}

// NOVO: Fun√ß√£o refatorada para processar ambas as entradas (tecla e toque)
function processResponse(key) {
    if (currentTrialState !== 'awaiting-response') return; // Checagem dupla

    // MODIFICADO: S√≥ limpa o timer se estiver no 'experiment' (pois na pr√°tica ele n√£o √© criado)
    if (currentPhase === 'experiment') {
        clearTimeout(responseDeadlineTimer);
    }
    document.getElementById('stimulus-element').classList.add('hidden');
    
    const rt = performance.now() - trialStartTime;
    const correct = (key === correctKey);
    
    if (currentPhase === 'experiment') {
        resultsData.push({
            block: currentBlockIndex,
            blockName: blockConfigs[currentBlockIndex].name, // Adicionado para an√°lise
            trial: currentTrialIndex,
            task: currentTask,
            trialType: trialSequence[currentTrialIndex].type,
            stimulus: currentStimulus,
            response: key,
            correct: correct,
            rt: rt,
            postError: lastTrialWasError
        });
        lastTrialWasError = !correct;
        startITI();
    } else {
        if (correct) {
            consecutiveCorrect++;
        } else {
            consecutiveCorrect = 0;
        }
        updatePracticeCounter();
        showPracticeFeedback(correct);
    }
}


function showPracticeFeedback(correct) {
    currentTrialState = 'showing-feedback';
    hideExperimentElements();
    document.getElementById('practice-counter').classList.remove('hidden');
    
    const feedbackElement = document.getElementById('feedback-element');
    
    // NOVO: Pega o container das cues visuais
    const cueContainer = document.getElementById('practice-cue-container');

    if (correct) {
        feedbackElement.textContent = "Correto ‚úì";
        feedbackElement.className = "feedback-correct";

        // NOVO: L√≥gica da Opacidade
        let newOpacity = 1;
        if (consecutiveCorrect === 1) newOpacity = 0.75;
        else if (consecutiveCorrect === 2) newOpacity = 0.5;
        else if (consecutiveCorrect === 3) newOpacity = 0.25;
        else if (consecutiveCorrect >= 4) newOpacity = 0;
        
        cueContainer.style.opacity = newOpacity;

    } else {
        feedbackElement.textContent = "Incorreto ‚úó";
        feedbackElement.className = "feedback-incorrect";
        
        // NOVO: Reset da Opacidade
        cueContainer.style.opacity = 1;
    }
    feedbackElement.classList.remove('hidden');
    
    feedbackTimer = setTimeout(() => {
        if (currentTrialState === null) return; // Teste foi interrompido
        if (consecutiveCorrect >= PRACTICE_CRITERION) {
            showPracticeSuccess();
        } else {
            startITI();
        }
    }, PRACTICE_FEEDBACK_DURATION);
}

function showPracticeSuccess() {
    hideExperimentElements();
    
    // ATUALIZADO: Esconde as cues visuais
    document.getElementById('practice-cue-container').classList.add('hidden');

    const feedbackElement = document.getElementById('feedback-element');
    feedbackElement.textContent = "√ìtimo! Preparando o primeiro bloco...";
    feedbackElement.className = "feedback-correct";
    feedbackElement.classList.remove('hidden');
    
    setTimeout(() => {
        if (currentTrialState === null) return; // Teste foi interrompido
        startBlock(0); // Inicia o bloco 0 (primeiro bloco)
    }, 3000);
}

function setupAndRunBlock(blockIndex) {
    currentPhase = 'experiment';
    currentBlockIndex = blockIndex;
    currentTrialIndex = 0;
    lastTrialWasError = false;
    const config = blockConfigs[currentBlockIndex];
    
    trialSequence = generateGuaranteedDistribution(
        config.trials,
        50,
        Math.round(config.prob * 100)
    );
    
    currentTrialState = 'experiment'; // <--- CORRE√á√ÉO: Define o estado para o bloco come√ßar
    runTrial(); // Inicia o primeiro trial do bloco
}

function startBlock(blockIndex) {
    if (blockIndex >= blockConfigs.length) {
        showResults();
        return;
    }
    
    hideExperimentElements();
    document.getElementById('practice-counter').classList.add('hidden');
    
    if (blockIndex > 0) {
        // Mostra o prompt para blocos 1 e 2 (depois do 0 e 1)
        document.getElementById('block-indicator').textContent = "Bloco Conclu√≠do";
        document.getElementById('inter-block-prompt').classList.remove('hidden');
        document.getElementById('next-block-btn').onclick = () => {
            if (currentTrialState === null) return; // Teste foi interrompido
            document.getElementById('inter-block-prompt').classList.add('hidden');
            setupAndRunBlock(blockIndex);
        };
    } else {
        // blockIndex === 0, apenas roda (chamado pelo showPracticeSuccess)
        setupAndRunBlock(blockIndex);
    }
}

function startITI() {
    currentTrialState = 'iti';
    hideExperimentElements();
    document.getElementById('fixation-point').classList.remove('hidden');
    
    currentTrialIndex++;
    
    const itiDuration = getPseudoExponentialITI(ITI_MIN, ITI_MAX);
    itiTimer = setTimeout(runTrial, itiDuration);
}

// ############# FUN√á√ÉO ALTERADA #############
function skipToResults() {
    // Limpa todos os timers e interrompe o estado do experimento
    clearAllTimers();
    currentTrialState = null;
    currentPhase = 'start';
    
    // Chama a fun√ß√£o de resultados, que ir√° calcular com os dados dispon√≠veis
    // e navegar para a se√ß√£o 8.
    showResults();
}
// ############# FIM DA ALTERA√á√ÉO #############


function calculateCorrelation(x, y) {
    const n = x.length;
    if (n === 0) return 0;
    const sum_x = x.reduce((a, b) => a + b, 0);
    const sum_y = y.reduce((a, b) => a + b, 0);
    const sum_xy = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
    const sum_x2 = x.reduce((sum, xi) => sum + xi * xi, 0);
    const sum_y2 = y.reduce((sum, yi) => sum + yi * yi, 0);
    
    const numerator = n * sum_xy - sum_x * sum_y;
    const denominator = Math.sqrt((n * sum_x2 - sum_x * sum_x) * (n * sum_y2 - sum_y * sum_y));
    
    return denominator === 0 ? 0 : numerator / denominator;
}

function showResults() {
    // Garante que o estado do experimento seja limpo
    clearAllTimers();
    currentTrialState = null;
    currentPhase = 'start';

    navigateTo('section-8');
    
    const resultsContainer = document.getElementById('results-container');
    resultsContainer.innerHTML = '';
    
    // <--- CORRE√á√ÉO: Garante que blockConfigs exista, mesmo se o teste for pulado
    if (blockConfigs.length === 0) {
         const BASE_BLOCK_CONFIGS = [
            { prob: 0.25, trials: TRIALS_PER_BLOCK, name: "Baixa Frequ√™ncia (25%)" },
            { prob: 0.50, trials: TRIALS_PER_BLOCK, name: "M√©dia Frequ√™ncia (50%)" },
            { prob: 0.75, trials: TRIALS_PER_BLOCK, name: "Alta Frequ√™ncia (75%)" }
        ];
        // N√£o embaralha para manter a ordem se o teste n√£o foi feito
        blockConfigs = BASE_BLOCK_CONFIGS; 
    }
    
    const blockAnalysis = [];
    
    // Se n√£o houver dados (usu√°rio pulou TUDO), mostra uma mensagem
    if (resultsData.length === 0) {
        resultsContainer.innerHTML = "<p style='text-align: center; font-size: 1.1rem; color: #fbbf24;'>Nenhum dado do teste foi coletado. Complete o teste (ou parte dele) para ver seus resultados.</p>";
        // Limpa charts
        if (rtChart) rtChart.destroy();
        if (correlationChart) correlationChart.destroy();
        if (accuracyChart) accuracyChart.destroy();
    }
    
    blockConfigs.forEach((config, index) => {
        const blockData = resultsData.filter(d => d.block === index);
        
        const correct = blockData.filter(d => d.correct).length;
        const total = blockData.length;
        const accuracy = total > 0 ? (correct / total * 100).toFixed(1) : 0;
        
        let validTrials = blockData.filter(d => 
            d.correct && 
            d.trialType !== 'first' && 
            d.response !== 'timeout'
        );
        
        if (USE_POST_ERROR_EXCLUSION) {
            validTrials = validTrials.filter(d => !d.postError);
        }
        
        const repeatTrials = validTrials.filter(d => d.trialType === 'repeat');
        const switchTrials = validTrials.filter(d => d.trialType === 'switch');
        
        // Aplica trimming (importado do arquivo antigo)
        const repeatRTs = repeatTrials.map(t => t.rt);
        const switchRTs = switchTrials.map(t => t.rt);

        const trimmedRepeatRTs = modifiedRecursiveTrim(repeatRTs);
        const trimmedSwitchRTs = modifiedRecursiveTrim(switchRTs);

        const avgRepeatRT = trimmedRepeatRTs.length > 0
            ? trimmedRepeatRTs.reduce((acc, t) => acc + t, 0) / trimmedRepeatRTs.length
            : 0;

        const avgSwitchRT = trimmedSwitchRTs.length > 0
            ? trimmedSwitchRTs.reduce((acc, t) => acc + t, 0) / trimmedSwitchRTs.length
            : 0;

        // Custo de troca √© Troca - Repeti√ß√£o
        const switchCost = (avgRepeatRT > 0 && avgSwitchRT > 0) ? avgSwitchRT - avgRepeatRT : 0;
        
        blockAnalysis.push({
            name: config.name,
            prob: config.prob * 100,
            accuracy: parseFloat(accuracy),
            avgRepeatRT: avgRepeatRT,
            avgSwitchRT: avgSwitchRT,
            switchCost: switchCost
        });
        
        // S√≥ mostra o bloco se ele tiver sido iniciado (ou se nenhum dado existir)
        if (resultsData.length === 0 || total > 0) {
            resultsContainer.innerHTML += `
                <div class="card">
                    <h3>${config.name}</h3>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">Precis√£o</div>
                            <div class="result-value">${accuracy}%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Custo de Troca</div>
                            <div class="result-value">${switchCost.toFixed(0)} ms</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">TR Repeti√ß√£o</div>
                            <div class="result-value">${avgRepeatRT.toFixed(0)} ms</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">TR Troca</div>
                            <div class="result-value">${avgSwitchRT.toFixed(0)} ms</div>
                        </div>
                    </div>
                </div>
            `;
        }
    });
    
    // Cria os gr√°ficos (fun√ß√£o de correla√ß√£o foi atualizada)
    createCharts(blockAnalysis); 
    // Cria a an√°lise estat√≠stica (nova fun√ß√£o)
    createStatisticalAnalysis(blockAnalysis);
    // Cria a interpreta√ß√£o neuro (fun√ß√£o existente)
    createBrainInterpretation(blockAnalysis);
}

function createCharts(data) {
    // Limpa charts antigos se existirem
    if (rtChart) rtChart.destroy();
    if (correlationChart) correlationChart.destroy();
    if (accuracyChart) accuracyChart.destroy();

    // Filtra dados para garantir que apenas blocos com dados sejam plotados
    const chartData = data.filter(d => d.avgRepeatRT > 0 || d.avgSwitchRT > 0);
    
    // Se n√£o houver dados, usa todos os blocos com 0
    const dataToPlot = chartData.length > 0 ? chartData : data;

    
    // RT Chart
    const rtCtx = document.getElementById('rtChart').getContext('2d');
    rtChart = new Chart(rtCtx, {
        type: 'bar',
        data: {
            labels: dataToPlot.map(d => d.prob + '% Switches'),
            datasets: [
                {
                    label: 'TR Repeti√ß√£o',
                    data: dataToPlot.map(d => d.avgRepeatRT),
                    backgroundColor: 'rgba(59, 130, 246, 0.7)'
                },
                {
                    label: 'TR Troca',
                    data: dataToPlot.map(d => d.avgSwitchRT),
                    backgroundColor: 'rgba(239, 68, 68, 0.7)'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#d1d5db' } }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#9ca3af' },
                    grid: { color: 'rgba(156, 163, 175, 0.1)' }
                },
                x: {
                    ticks: { color: '#9ca3af' },
                    grid: { color: 'rgba(156, 163, 175, 0.1)' }
                }
            }
        }
    });
    
    // Correlation Chart (Vers√£o melhorada do arquivo antigo)
    const x = dataToPlot.map(d => d.prob);
    const y = dataToPlot.map(d => d.switchCost);
    
    let r = 0, pValue = 1.0;
    if (chartData.length > 1) { // S√≥ calcula correla√ß√£o se tiver pelo menos 2 pontos de dados reais
         r = calculateCorrelation(x, y);
         pValue = calculatePValue(r, x.length);
    }

    // Linha de regress√£o
    let regressionPoints = [];
    if(chartData.length > 1) {
        const meanX = x.reduce((a, b) => a + b) / x.length;
        const meanY = y.reduce((a, b) => a + b) / y.length;
        const x_minus_meanX = x.map(val => val - meanX);
        const y_minus_meanY = y.map(val => val - meanY);
        const xy = x_minus_meanX.map((val, i) => val * y_minus_meanY[i]);
        const xx = x_minus_meanX.map(val => val * val);
        const slope = xx.reduce((a,b) => a+b, 0) === 0 ? 0 : xy.reduce((a,b) => a+b, 0) / xx.reduce((a,b) => a+b, 0);
        const intercept = meanY - slope * meanX;

        regressionPoints = [
            { x: 25, y: slope * 25 + intercept },
            { x: 75, y: slope * 75 + intercept }
        ];
    }
    
    const corrCtx = document.getElementById('correlationChart').getContext('2d');
    correlationChart = new Chart(corrCtx, {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'Custo de Troca',
                data: dataToPlot.map(d => ({ x: d.prob, y: d.switchCost })),
                backgroundColor: '#ef4444',
                pointRadius: 8
            },
            {
                label: 'Linha de Tend√™ncia',
                data: regressionPoints,
                type: 'line',
                borderColor: '#fbbf24',
                borderWidth: 3,
                borderDash: [5, 5],
                pointRadius: 0,
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#d1d5db' } },
                title: {
                    display: true,
                    text: `Correla√ß√£o: r = ${r.toFixed(3)}, p ${pValue < 0.05 ? '< 0.05' : '‚â• 0.05'}`,
                    color: pValue < 0.05 ? '#22c55e' : '#fbbf24',
                    font: { size: 16 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#9ca3af' },
                    grid: { color: 'rgba(156, 163, 175, 0.1)' },
                    title: { display: true, text: 'Custo de Troca (ms)', color: '#9ca3af'}
                },
                x: {
                    ticks: { color: '#9ca3af' },
                    grid: { color: 'rgba(156, 163, 175, 0.1)' },
                    title: { display: true, text: '% de Mudan√ßas', color: '#9ca3af'}
                }
            }
        }
    });
    
    // Accuracy Chart
    const accCtx = document.getElementById('accuracyChart').getContext('2d');
    accuracyChart = new Chart(accCtx, {
        type: 'doughnut',
        data: {
            labels: dataToPlot.map(d => d.prob + '% Bloco'),
            datasets: [{
                label: 'Acur√°cia',
                data: dataToPlot.map(d => d.accuracy),
                backgroundColor: [
                    'rgba(59, 130, 246, 0.7)',
                    'rgba(6, 182, 212, 0.7)',
                    'rgba(34, 197, 94, 0.7)'
                ],
                borderColor: '#1f2937',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { color: '#d1d5db' }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: ${context.raw.toFixed(1)}%`;
                        }
                    }
                }
            }
        }
    });
}

// NOVA FUN√á√ÉO (DO ARQUIVO ANTIGO)
function createStatisticalAnalysis(data) {
    // Filtra para garantir que temos dados para calcular
    const validData = data.filter(d => d.avgRepeatRT > 0 || d.avgSwitchRT > 0);
    const validX = validData.map(d => d.prob);
    const validY = validData.map(d => d.switchCost);

    let r = 0, pValue = 1.0;
    if (validX.length > 1) { // Precisa de pelo menos 2 pontos para correla√ß√£o
        r = calculateCorrelation(validX, validY);
        pValue = calculatePValue(r, validX.length);
    } else {
        r = 0;
        pValue = 1.0;
    }


    let interpretation = '';
    let interpretationClass = '';
    let validity = '';

    if (resultsData.length === 0) {
        interpretation = '<strong>Teste n√£o realizado.</strong> Complete o teste para gerar a an√°lise estat√≠stica.';
        interpretationClass = 'interpretation-neutral';
        validity = 'N/A';
    } else if (validX.length < 2) {
        interpretation = '<strong>Dados insuficientes.</strong> √â preciso completar pelo menos dois blocos do teste para calcular a correla√ß√£o.';
        interpretationClass = 'interpretation-neutral';
        validity = 'N/A';
    } else if (Math.abs(r) > 0.8 && pValue < 0.05) {
        interpretation = '<strong>Correla√ß√£o forte e significativa!</strong> Seus resultados demonstram claramente que o aumento na frequ√™ncia de trocas est√° associado √† diminui√ß√£o do custo de troca. Isso indica <strong>boa adapta√ß√£o cognitiva</strong>.';
        interpretationClass = 'interpretation-good';
        validity = '‚úÖ Resultado estatisticamente v√°lido';
    } else if (Math.abs(r) > 0.5 && pValue < 0.10) {
        interpretation = '<strong>Correla√ß√£o moderada.</strong> H√° evid√™ncias de uma tend√™ncia de adapta√ß√£o, mas os resultados n√£o s√£o conclusivos. Isso pode ocorrer por varia√ß√£o individual ou pelo n√∫mero limitado de blocos.';
        interpretationClass = 'interpretation-neutral';
        validity = '‚ö†Ô∏è Resultado sugestivo, mas n√£o conclusivo';
    } else {
        interpretation = '<strong>Correla√ß√£o fraca ou n√£o significativa.</strong> N√£o h√° evid√™ncias estat√≠sticas suficientes de adapta√ß√£o nos seus dados. Isso pode ocorrer por: fadiga, ordem dos blocos, varia√ß√£o individual, ou n√∫mero limitado de tentativas.';
        interpretationClass = 'interpretation-neutral';
        validity = '‚ùå Resultado n√£o atinge signific√¢ncia estat√≠stica';
    }

    const statsHTML = `
        <h2 style="margin-top: 40px;">üìä An√°lise Estat√≠stica</h2>
        <div class="stat-box">
            <h4>Correla√ß√£o de Pearson</h4>
            <p>Coeficiente: <span class="stat-highlight">r = ${r.toFixed(3)}</span></p>
            <p>Valor-p: <span class="stat-highlight">p ${pValue < 0.05 ? '< 0.05' : pValue < 0.10 ? '< 0.10' : '‚â• 0.10'}</span></p>
            <p style="margin-top: 10px; font-size: 0.95rem; color: #9ca3af;">
                ${Math.abs(r) < 0.3 ? 'Correla√ß√£o fraca' : Math.abs(r) < 0.7 ? 'Correla√ß√£o moderada' : 'Correla√ß√£o forte'} 
                ${r < 0 ? 'negativa' : 'positiva'} entre probabilidade de troca e custo de troca.
            </p>
        </div>

        <div class="stat-box">
            <h4>Validade Estat√≠stica</h4>
            <p><span class="stat-highlight">${validity}</span></p>
            <p style="margin-top: 10px; font-size: 0.95rem; color: #9ca3af;">
                Crit√©rio: p < 0.05 para signific√¢ncia estat√≠stica em pesquisa cient√≠fica.
            </p>
        </div>

        <div class="interpretation ${interpretationClass}" style="margin-top: 20px;">
            <p>${interpretation}</p>
        </div>

        <div class="stat-box" style="margin-top: 20px;">
            <h4>üí° Interpreta√ß√£o para Leigos</h4>
            <p>
                <strong>O que √© o custo de troca?</strong><br>
                √â a diferen√ßa de tempo entre fazer a mesma tarefa repetidamente versus alternar entre tarefas diferentes. 
                Quanto menor o custo, melhor voc√™ est√° se adaptando √†s mudan√ßas.
            </p>
            <p style="margin-top: 15px;">
                <strong>O que significa a correla√ß√£o?</strong><br>
                Medimos se h√° uma rela√ß√£o entre <em>quantas vezes voc√™ troca</em> e <em>qu√£o r√°pido voc√™ se adapta</em>. 
                Uma correla√ß√£o negativa forte (pr√≥xima de -1) indica que quanto mais voc√™ pratica trocar, menor o custo - sinal de boa adapta√ß√£o cerebral!
            </p>
            <p style="margin-top: 15px;">
                <strong>O que √© o valor-p?</strong><br>
                √â a probabilidade de os resultados seriam devidos ao acaso. Valores abaixo de 0.05 (5%) s√£o considerados 
                estatisticamente significativos - ou seja, provavelmente n√£o s√£o coincid√™ncia!
            </p>
        </div>
    `;

    document.getElementById('statistical-analysis').innerHTML = statsHTML;
}

// FUN√á√ÉO EXISTENTE (SEM MODIFIFICA√á√ïES)
function createBrainInterpretation(data) {
    
    const validData = data.filter(d => d.avgRepeatRT > 0 || d.avgSwitchRT > 0);
    let r = 0;
    if (validData.length > 1) {
         const x = validData.map(d => d.prob);
         const y = validData.map(d => d.switchCost);
         r = calculateCorrelation(x, y);
    }
    
    let interpretation = '';

    if (resultsData.length === 0) {
        document.getElementById('brain-interpretation').innerHTML = '';
        return;
    }
    
    if (r < -0.5) {
        interpretation = `
            <div class="card" style="background-color: #111827; border-left-color: #22c55e;">
                <h3 style="color: #22c55e;">‚úÖ Excelente Adapta√ß√£o (Padr√£o Esperado)!</h3>
                <p style="font-size: 1.1rem; line-height: 1.8;">
                    Sua <strong>Rede Fronto-Parietal</strong> demonstrou uma forte capacidade de adapta√ß√£o! 
                    Sua correla√ß√£o negativa (r = ${r.toFixed(3)}) indica que seu c√©rebro se ajustou como esperado: 
                    <strong>quanto mais frequentes as mudan√ßas, menor foi seu custo de troca</strong>.
                </p>
                <p style="margin-top: 15px;">
                    Seu <strong>IPS</strong> provavelmente codificou bem os padr√µes estat√≠sticos, 
                    permitindo que voc√™ ficasse "pronto para mudar" e mais r√°pido quando as mudan√ßas eram comuns!
                </p>
            </div>
        `;
    } else {
        interpretation = `
            <div class="card" style="background-color: #111827; border-left-color: #fbbf24;">
                <h3 style="color: #fbbf24;">üìä Padr√£o de Adapta√ß√£o</h3>
                <p style="font-size: 1.1rem; line-height: 1.8;">
                    Sua correla√ß√£o (r = ${r.toFixed(3)}) mostra seu padr√£o de adapta√ß√£o. O padr√£o cient√≠fico esperado √© uma 
                    correla√ß√£o negativa (custo de troca diminui com mais mudan√ßas). Varia√ß√µes s√£o normais e podem ocorrer por:
                </p>
                <ul>
                    <li>Fadiga ou distra√ß√£o ao longo do teste</li>
                    <li>Ordem aleat√≥ria dos blocos</li>
                    <li>Vers√£o demonstrativa (menos tentativas para estabelecer o padr√£o)</li>
                    <li>Varia√ß√£o individual na estrat√©gia</li>
                </ul>
                <p style="margin-top: 15px;">
                    Independentemente do resultado, sua <strong>Rede Fronto-Parietal</strong> trabalhou intensamente para monitorar 
                    e trocar de tarefas durante todo o teste!
                </p>
            </div>
        `;
    }
    
    document.getElementById('brain-interpretation').innerHTML = interpretation;
}

// ========================================
// EVENT LISTENERS
// ========================================

document.addEventListener('keydown', handleKeyPress);

// ========================================
// INITIALIZE
// ========================================

// ############# CORRE√á√ÉO DE E inicializa√ß√£o #############
// Troca 'window.onload' por 'DOMContentLoaded' para garantir que o DOM est√° pronto
document.addEventListener('DOMContentLoaded', function() {
    navigateTo('section-1'); // Garante que a primeira se√ß√£o seja mostrada
    updateTestDurations(); // Calcula as dura√ß√µes do teste

    // NOVO: Adiciona listeners de toque
    // Usamos 'touchstart' para a resposta mais r√°pida, 'mousedown' como fallback
    const touchLeft = document.getElementById('touch-left');
    const touchRight = document.getElementById('touch-right');
    
    if(touchLeft && touchRight) { // Adiciona checagem de seguran√ßa
        touchLeft.addEventListener('touchstart', handleTouchStart, { passive: false });
        touchRight.addEventListener('touchstart', handleTouchStart, { passive: false });
        
        // Fallback para cliques de mouse em desktop se o modo 'touch' for for√ßado
        touchLeft.addEventListener('mousedown', handleTouchStart, { passive: false });
        touchRight.addEventListener('mousedown', handleTouchStart, { passive: false });
    } else {
        console.error("Elementos de toque (touch-left, touch-right) n√£o encontrados no DOM.");
    }
});
// ############# FIM DA CORRE√á√ÉO #############

</script>

</body>
</html>
